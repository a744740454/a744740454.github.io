<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SadnessPineapple</title>
  
  
  <link href="https://a744740454.github.io/atom.xml" rel="self"/>
  
  <link href="https://a744740454.github.io/"/>
  <updated>2021-02-23T10:57:35.831Z</updated>
  <id>https://a744740454.github.io/</id>
  
  <author>
    <name>Sadness Pineapple</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>flask的路由系统</title>
    <link href="https://a744740454.github.io/2021/02/23/flask/flask%E7%9A%84%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F/"/>
    <id>https://a744740454.github.io/2021/02/23/flask/flask%E7%9A%84%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F/</id>
    <published>2021-02-23T10:56:54.473Z</published>
    <updated>2021-02-23T10:57:35.831Z</updated>
    
    <content type="html"><![CDATA[<h2 id="flask的路由系统"><a href="#flask的路由系统" class="headerlink" title="flask的路由系统"></a>flask的路由系统</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">flask中最经典的设置路由的方式是通过装饰器</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#route的参数</span></span><br><span class="line"><span class="number">1.</span>rule 路径 <span class="comment">#这个必须要填</span></span><br><span class="line"><span class="number">2.</span>options</span><br><span class="line">methods     <span class="comment">#允许进入的请求方式，例如GET,POST</span></span><br><span class="line">    endpoint    <span class="comment">#别名，用于做反向解析,不写，默认是函数名</span></span><br><span class="line">    default     <span class="comment">#给函数传递的参数</span></span><br><span class="line">    redirect_to <span class="comment">#重定向的地址</span></span><br><span class="line">strict_slashes = <span class="literal">None</span> <span class="comment">#对URL最后的 / 符号是否严格要求</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#转换器</span></span><br><span class="line">我们还可以使用在路由中使用转换器</span><br><span class="line">eg:</span><br><span class="line"><span class="meta">    @app.route(<span class="params"><span class="string">&#x27;/detail/&lt;int:nid&gt;&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>],endpoint=<span class="string">&#x27;detail&#x27;</span></span>)</span></span><br><span class="line"></span><br><span class="line">flask我们还可以设置另外一种路由方式</span><br><span class="line"><span class="comment">#FBV式的</span></span><br><span class="line">app.add_url_rule(<span class="string">&#x27;/&#x27;</span>,endpoint=<span class="string">&#x27;index&#x27;</span>,view_func=index)</span><br><span class="line"></span><br><span class="line"><span class="comment">#CBV式的</span></span><br><span class="line">app.add_url_rule(<span class="string">&#x27;/&#x27;</span>,endpoint=<span class="string">&#x27;index&#x27;</span>,view_func=index.as_view(name=<span class="string">&#x27;index&#x27;</span>)) <span class="comment">#as_view中的name必填</span></span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;flask的路由系统&quot;&gt;&lt;a href=&quot;#flask的路由系统&quot; class=&quot;headerlink&quot; title=&quot;flask的路由系统&quot;&gt;&lt;/a&gt;flask的路由系统&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;</summary>
      
    
    
    
    <category term="flask" scheme="https://a744740454.github.io/categories/flask/"/>
    
    
    <category term="flask" scheme="https://a744740454.github.io/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>drf视图类及路由设置</title>
    <link href="https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E8%A7%86%E5%9B%BE%E7%B1%BB%E5%8F%8A%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE/"/>
    <id>https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E8%A7%86%E5%9B%BE%E7%B1%BB%E5%8F%8A%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE/</id>
    <published>2021-02-22T11:50:55.194Z</published>
    <updated>2021-02-22T11:53:07.597Z</updated>
    
    <content type="html"><![CDATA[<h2 id="drf视图类及路由设置"><a href="#drf视图类及路由设置" class="headerlink" title="drf视图类及路由设置"></a>drf视图类及路由设置</h2><h3 id="drf两个基类"><a href="#drf两个基类" class="headerlink" title="drf两个基类"></a>drf两个基类</h3><p>1.APIView</p><p>​    该类是继承了django原生view类的drf类，他重写了django类的as_view方法，将request换成了自己的request，并做了认证等功能</p><p>​    ps:可以从rest_framework.views</p><p>2.GenericAPIView </p><p>​    该类继承了APIView是对APIView的进一步封装</p><p>​    ps:可以从 rest_framework.generics 导入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#继承该类后你只需要在类的开头为类添加queryset，serializer_class</span></span><br><span class="line"><span class="comment">#之后每次之后每次只需要调用get_queryset()就可以或得queryset对象</span></span><br><span class="line"><span class="comment">#每次只需要调用get_serializer()就可以或得序列化器对象对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">    queryset = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = serialize.BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        queryset = self.get_queryset()</span><br><span class="line">        ser = self.get_serializer(instance=queryset, many=<span class="literal">True</span>)</span><br><span class="line">        print(ser.data)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h3 id="5个视图扩展类"><a href="#5个视图扩展类" class="headerlink" title="5个视图扩展类"></a>5个视图扩展类</h3><p>基于drf的两个基类又扩展出了5个扩展类，他们是基于上述两个基类之后又进行了一步封装</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">可以从rest_framework.mixins中导入 </span><br><span class="line">这五个类需要与GenericAPIView类一起使用</span><br><span class="line">CreateModelMixin <span class="comment">#创建数据 依然需要写post()</span></span><br><span class="line">DestroyModelMixin <span class="comment">#删除单条数据 依然需要写delete()</span></span><br><span class="line">UpdateModelMixin <span class="comment"># 更新数据库数据 依然需要写put()</span></span><br><span class="line">ListModelMixin <span class="comment"># 获得多条数据   需要写名词复数类的get()</span></span><br><span class="line">RetrieveModelMixin <span class="comment">#获得单条数据 需要写名词类的get()</span></span><br><span class="line"></span><br><span class="line">这些类的内部做的就是我们之前写的调用序列化器，将queryset对象传入等操作，这样我们只需要做到简单的调用方法即可</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">GenericAPIView,ListModelMixin</span>):</span></span><br><span class="line">    queryset = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = serialize.BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,*args,**kwargs</span>):</span> <span class="comment"># 写get方法</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request,*args,**kwargs)</span><br></pre></td></tr></table></figure><h3 id="9个子类视图"><a href="#9个子类视图" class="headerlink" title="9个子类视图"></a>9个子类视图</h3><p>这九个子类视图则是对五个视图扩展类的进一步封装，上述五个视图扩展类还需要我们写get等方法，接下来我们只需要通过继承，就可以实现我们需要的功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">这九个子类视图我们可以通过rest_framework.generics获得</span><br><span class="line">下述五个实现了基本功能</span><br><span class="line">CreateAPIView ，GenericAPIView，CreateModelMixin</span><br><span class="line">ListAPIView</span><br><span class="line">DestroyAPIView</span><br><span class="line">UpdateAPIView</span><br><span class="line">RetrieveAPIView</span><br><span class="line"></span><br><span class="line">下述<span class="number">4</span>个则是功能的混合搭配</span><br><span class="line">ListCreateAPIView：同时具备查询多个以及创建数据的功能</span><br><span class="line">RetrieveDestroyAPIView：具备查询一个以及删除的功能</span><br><span class="line">RetrieveUpdateAPIView：具备查询一个以及更新的功能</span><br><span class="line">RetrieveUpdateDestroyAPIView：具备查询一个以及更新以及删除的功能</span><br></pre></td></tr></table></figure><h3 id="视图集"><a href="#视图集" class="headerlink" title="视图集"></a>视图集</h3><p>ModelViewSet类则是对上述代码的进一步封装，我们只需要继承该类并在路由中进行一定的配置就可以简单的完成路由与视图的搭配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">该类需要从rest_framework.viewsets中导入</span><br><span class="line"></span><br><span class="line">这个类继承了五个视图扩展类以及GenericViewSet</span><br><span class="line">GenericViewSet:该类继承了ViewSetMixin, generics.GenericAPIView</span><br><span class="line">ViewSet:该类继承ViewSetMixin和APIView</span><br><span class="line">其中的重点便是ViewSetMixin该混合类重写了as_view方法，正是由于重写的这个方法帮助我们做到了视图与类方法的映射</span><br><span class="line"></span><br><span class="line">ps:ReadOnlyModelViewSet：继承mixins.RetrieveModelMixin,mixins.ListModelMixin,GenericViewSet,该类不具备写入的功能</span><br></pre></td></tr></table></figure><h3 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h3><p>我们让一个类继承了ModelViewSet之后我们便需要对视图进行一定的修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line">最原始的直接写</span><br><span class="line"></span><br><span class="line">下述两个方法都需要继承ModelViewSet之后才能使用</span><br><span class="line">方式二：</span><br><span class="line">url(<span class="string">r&#x27;^books/&#x27;</span>, views.Books.as_view(&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>&#125;<span class="comment">#这里写一个字典代表映射关系)),当get请求过来的时候会执行list方法</span></span><br><span class="line">                                    </span><br><span class="line">方式三：自动化创建路径</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line">router = routers.SimpleRouter()</span><br><span class="line">router.register(<span class="string">&#x27;路径前缀&#x27;</span>,指定的视图类 ) </span><br><span class="line">eg:router.register(<span class="string">&#x27;books&#x27;</span>, views.Books )</span><br><span class="line">                                    </span><br><span class="line">若使用方式三自动创建路径,若我们需要指定运行的方法时该如何做</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action 导入action装饰器</span><br><span class="line">在你需要执行的类方法上添加该装饰器</span><br><span class="line">                                    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = serialize.BookSerializer</span><br><span class="line">                                    </span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>],detail=<span class="literal">False</span></span>) </span><span class="comment">#当get方法来的时候执行该类方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">aaa</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        print(self.action)</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">                                    </span><br><span class="line">action参数的含义:                                  </span><br><span class="line">-methods：什么请求方式会触发被装饰函数的执行</span><br><span class="line">-detail：是<span class="literal">True</span>是基于带<span class="built_in">id</span>的路由生成的，如果是<span class="literal">False</span>，是基于不带<span class="built_in">id</span>的路由生成的</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;drf视图类及路由设置&quot;&gt;&lt;a href=&quot;#drf视图类及路由设置&quot; class=&quot;headerlink&quot; title=&quot;drf视图类及路由设置&quot;&gt;&lt;/a&gt;drf视图类及路由设置&lt;/h2&gt;&lt;h3 id=&quot;drf两个基类&quot;&gt;&lt;a href=&quot;#drf两个基类&quot; c</summary>
      
    
    
    
    <category term="rest-framework" scheme="https://a744740454.github.io/categories/rest-framework/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="rest-framework" scheme="https://a744740454.github.io/tags/rest-framework/"/>
    
    <category term="drf" scheme="https://a744740454.github.io/tags/drf/"/>
    
  </entry>
  
  <entry>
    <title>drf认证、权限、频率实现</title>
    <link href="https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E8%AE%A4%E8%AF%81%E3%80%81%E6%9D%83%E9%99%90%E3%80%81%E9%A2%91%E7%8E%87%E5%AE%9E%E7%8E%B0/"/>
    <id>https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E8%AE%A4%E8%AF%81%E3%80%81%E6%9D%83%E9%99%90%E3%80%81%E9%A2%91%E7%8E%87%E5%AE%9E%E7%8E%B0/</id>
    <published>2021-02-22T11:50:51.470Z</published>
    <updated>2021-02-22T11:53:21.232Z</updated>
    
    <content type="html"><![CDATA[<h2 id="drf认证、权限、频率实现"><a href="#drf认证、权限、频率实现" class="headerlink" title="drf认证、权限、频率实现"></a>drf认证、权限、频率实现</h2><h3 id="drf认证功能实现"><a href="#drf认证功能实现" class="headerlink" title="drf认证功能实现"></a>drf认证功能实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>创建一个任意的py文件，在里面任意的定义一个类，假设该类名为MyAuth</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>继承BaseAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication 从这里导入</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>为该类创建一个authenticate方法</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>在该类中书写认证方法，如果认证成功返回none或元祖，认证失败的话抛出一个异常AuthenticationFailed</span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login_Auth</span>(<span class="params">BaseAuthentication</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        token = request.GET.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            models.Auth.objects.get(token=token)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> <span class="comment">#ps:也可以返回一个元祖</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;还未登录，请先登录&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="drf权限功能的实现"><a href="#drf权限功能的实现" class="headerlink" title="drf权限功能的实现"></a>drf权限功能的实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">过程与认证功能基本一致，只不过创建的类继承的类不一样，权限功能继承的类为BasePermission</span><br><span class="line">重写的方法为has_permission</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookPermission</span>(<span class="params">BasePermission</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span>(<span class="params">self, request, view</span>):</span> <span class="comment">#这里的request与view为之前认证功能返回的元祖中的数据</span></span><br><span class="line">        <span class="keyword">if</span> request.user.user_type == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span> <span class="comment">#如果权限通过返回true</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> <span class="comment">#如果权限未通过返回false</span></span><br></pre></td></tr></table></figure><h3 id="内置频率类使用"><a href="#内置频率类使用" class="headerlink" title="内置频率类使用"></a>内置频率类使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">django为我们提供了多个限制频率类</span><br><span class="line">BaseThrottle：基类</span><br><span class="line">AnonRateThrottle：限制匿名用户的访问次数 <span class="comment">#内部通过request.user.isauthenticed判断</span></span><br><span class="line">    SimpleRateThrottle：可以通过自定义扩写它</span><br><span class="line">    ScopedRateThrottle：</span><br><span class="line">    UserRateThrottle：限制登录用户访问次数 </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">使用方法，新建一个类继承SimpleRateThrottle，内部定义一个scope属性，并且重写get_cache_key方法</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">    scope = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.get_ident(request)</span><br><span class="line">    </span><br><span class="line">在setting.py中配置</span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&quot;DEFAULT_THROTTLE_CLASSES&quot;</span>:[<span class="string">&#x27;app01.auth.MyThrottle&#x27;</span>,],</span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span> : &#123;</span><br><span class="line">        <span class="string">&#x27;xxx&#x27;</span>:<span class="string">&#x27;10/m&#x27;</span><span class="comment"># key跟scope对应，value是一个时间</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="认证功能、权限功能、频率功能局部使用和全局使用"><a href="#认证功能、权限功能、频率功能局部使用和全局使用" class="headerlink" title="认证功能、权限功能、频率功能局部使用和全局使用"></a>认证功能、权限功能、频率功能局部使用和全局使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 全局使用（所有接口，都需要登录才能访问）</span><br><span class="line">-在配置文件中</span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthen.LoginAuth&quot;</span>, ], <span class="comment">#认证有关</span></span><br><span class="line">        <span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthen.SuperPermission&quot;</span>, ] <span class="comment">#权限有关</span></span><br><span class="line">        <span class="string">&quot;DEFAULT_THROTTLE_CLASSES&quot;</span>:[<span class="string">&#x27;app01.auth.MyThrottle&#x27;</span>,],<span class="comment">#频率相关</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span> : &#123;</span><br><span class="line">        <span class="string">&#x27;xxx&#x27;</span>:<span class="string">&#x27;10/m&#x27;</span><span class="comment"># key跟scope对应，value是一个时间</span></span><br><span class="line">    &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="number">2</span> 局部使用</span><br><span class="line">-在想局部使用的视图类上</span><br><span class="line">authentication_classes = [MyAuthen.LoginAuth,] <span class="comment">#认证有关</span></span><br><span class="line">    permission_classes = [MyAuthen.SuperPermission] <span class="comment">#权限有关</span></span><br><span class="line">    throttle_classes = [auth.MyThrottle]</span><br><span class="line"><span class="number">3</span> 局部禁用</span><br><span class="line">-在想禁用的视图类上</span><br><span class="line">    authentication_classes = []</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;drf认证、权限、频率实现&quot;&gt;&lt;a href=&quot;#drf认证、权限、频率实现&quot; class=&quot;headerlink&quot; title=&quot;drf认证、权限、频率实现&quot;&gt;&lt;/a&gt;drf认证、权限、频率实现&lt;/h2&gt;&lt;h3 id=&quot;drf认证功能实现&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="rest-framework" scheme="https://a744740454.github.io/categories/rest-framework/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="rest-framework" scheme="https://a744740454.github.io/tags/rest-framework/"/>
    
    <category term="drf" scheme="https://a744740454.github.io/tags/drf/"/>
    
  </entry>
  
  <entry>
    <title>drf过滤、排序、分页器</title>
    <link href="https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E8%BF%87%E6%BB%A4%E3%80%81%E6%8E%92%E5%BA%8F%E3%80%81%E5%88%86%E9%A1%B5%E5%99%A8/"/>
    <id>https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E8%BF%87%E6%BB%A4%E3%80%81%E6%8E%92%E5%BA%8F%E3%80%81%E5%88%86%E9%A1%B5%E5%99%A8/</id>
    <published>2021-02-22T11:50:48.280Z</published>
    <updated>2021-02-22T11:52:01.063Z</updated>
    
    <content type="html"><![CDATA[<h2 id="drf过滤、排序、分页器"><a href="#drf过滤、排序、分页器" class="headerlink" title="drf过滤、排序、分页器"></a>drf过滤、排序、分页器</h2><h3 id="drf内置的排序、过滤功能使用"><a href="#drf内置的排序、过滤功能使用" class="headerlink" title="drf内置的排序、过滤功能使用"></a>drf内置的排序、过滤功能使用</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">使用的话十分的简单</span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter, SearchFilter 导入这两个类，在可以进行查询的接口中进行一定的配置即可</span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤功能</span></span><br><span class="line">filter_backends = [SearchFilter,]</span><br><span class="line">search_fields=(<span class="string">&#x27;name&#x27;</span>,) <span class="comment"># 表中的字段，会去表中该字段进行匹配</span></span><br><span class="line">路径中的写入方式</span><br><span class="line">http://127.0.0.1:8000/students/?search=e # 只能写search</span><br><span class="line">            </span><br><span class="line"><span class="comment">#排序功能</span></span><br><span class="line"> filter_backends = [OrderingFilter]</span><br><span class="line"> ordering_fields = (<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;id&#x27;</span>) <span class="comment">#表中的字段，可以以这些字段进行排序</span></span><br><span class="line">路径中的书写方式</span><br><span class="line">http://127.0.0.1:8000/students/?ordering=-age # 必须写ordering</span><br></pre></td></tr></table></figure><h3 id="django-filter的使用"><a href="#django-filter的使用" class="headerlink" title="django-filter的使用"></a>django-filter的使用</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>先下载django-<span class="built_in">filter</span></span><br><span class="line"><span class="number">2.</span>导入类</span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="number">3.</span>在视图类中进行配置</span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line">    filter_fields = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;price&#x27;</span>) <span class="comment">#模型中的字段，以这些为查询条件</span></span><br><span class="line"><span class="number">4.</span>路径中的参数</span><br><span class="line">http://127.0.0.1:8000/book/?name=西游记 #为精准匹配，不是模糊查询</span><br></pre></td></tr></table></figure><h3 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>导入基类</span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> BaseFilterBackend</span><br><span class="line"><span class="number">2.</span>继承并重写他的filter_queryset方法</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter_queryset</span>(<span class="params">self, request, queryset, view</span>):</span></span><br><span class="line">        <span class="keyword">return</span> queryset  <span class="comment">#必须返回一个queryset对象</span></span><br><span class="line"><span class="number">3.</span>直接在视图类里使用</span><br><span class="line"> filter_backends = [Myfilter.MyFilter]   </span><br></pre></td></tr></table></figure><h3 id="drf分页器的使用"><a href="#drf分页器的使用" class="headerlink" title="drf分页器的使用"></a>drf分页器的使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">drf为我们提供了<span class="number">3</span>种分页器</span><br><span class="line"><span class="number">1.</span>PageNumberPagination</span><br><span class="line">我们可以新建一个类然后继承该类，然后在该类中添加<span class="number">4</span>个属性</span><br><span class="line">    page_size = <span class="number">1</span>  <span class="comment"># 每页显示多少条</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;page&#x27;</span>  <span class="comment"># 查询参数</span></span><br><span class="line">    eg：http://127.0.0.1:8000/book/?page=1</span><br><span class="line">    page_size_query_param = <span class="string">&#x27;size&#x27;</span>  <span class="comment"># 查询的时候你按什么名称来指定每页显示多少条</span></span><br><span class="line">    eg:http://127.0.0.1:8000/book/?size=3 # 指定每页显示3条，不指定按默认之前配的page_size来</span><br><span class="line">    max_page_size = <span class="number">10</span>  <span class="comment"># 每页最多显示多少条</span></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>LimitOffsetPagination    </span><br><span class="line">default_limit = <span class="number">2</span>  <span class="comment"># 默认条数</span></span><br><span class="line">    limit_query_param = <span class="string">&#x27;limit&#x27;</span>             <span class="comment"># 查询时，指定查询多少条</span></span><br><span class="line">    offset_query_param = <span class="string">&#x27;offset&#x27;</span>           <span class="comment"># 查询时，指定的起始位置是哪 </span></span><br><span class="line">    max_limit = <span class="literal">None</span>                        <span class="comment"># 查询时，最多返回多少条</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>CursorPagination</span><br><span class="line">cursor_query_param = <span class="string">&#x27;cursor&#x27;</span>  <span class="comment"># 查询的时候，指定的查询方式</span></span><br><span class="line">    page_size = <span class="number">2</span> <span class="comment"># 每页显示多少条</span></span><br><span class="line">    ordering = <span class="string">&#x27;-created&#x27;</span>   <span class="comment"># 排序方式</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;size&#x27;</span>  <span class="comment"># 查询的时候指定每页显示多少条</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>          <span class="comment">#每页最多显示多少条</span></span><br><span class="line"></span><br><span class="line">使用方式在视图类中添加</span><br><span class="line">pagination_class = MyPage</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">7</span> APIView的分页模式</span><br><span class="line">-新建一个类，继承普通分页，重写四个属性</span><br><span class="line">-视图类写法如下</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentApiView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        student_list=Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        page=MyPageNumberPagination()<span class="comment"># 实例化得到对象</span></span><br><span class="line">        <span class="comment"># 只需要换不同的分页类即可</span></span><br><span class="line">        res=page.paginate_queryset(student_list,request,self)<span class="comment"># 开始分页</span></span><br><span class="line">        ser=StudentSerializer(res,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> page.get_paginated_response(ser.data) <span class="comment"># 返回数据</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;drf过滤、排序、分页器&quot;&gt;&lt;a href=&quot;#drf过滤、排序、分页器&quot; class=&quot;headerlink&quot; title=&quot;drf过滤、排序、分页器&quot;&gt;&lt;/a&gt;drf过滤、排序、分页器&lt;/h2&gt;&lt;h3 id=&quot;drf内置的排序、过滤功能使用&quot;&gt;&lt;a href=</summary>
      
    
    
    
    <category term="rest-framework" scheme="https://a744740454.github.io/categories/rest-framework/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="rest-framework" scheme="https://a744740454.github.io/tags/rest-framework/"/>
    
    <category term="drf" scheme="https://a744740454.github.io/tags/drf/"/>
    
  </entry>
  
  <entry>
    <title>RESTful API规范</title>
    <link href="https://a744740454.github.io/2021/02/22/django/rest-framework/RESTful%20API%E8%A7%84%E8%8C%83/"/>
    <id>https://a744740454.github.io/2021/02/22/django/rest-framework/RESTful%20API%E8%A7%84%E8%8C%83/</id>
    <published>2021-02-22T11:47:43.320Z</published>
    <updated>2021-02-22T11:49:25.566Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RESTful-API规范-10条"><a href="#RESTful-API规范-10条" class="headerlink" title="RESTful API规范(10条)"></a>RESTful API规范(10条)</h3><p>​    REST全称是<strong>Representational State Transfer</strong>，中文意思是表述（编者注：通常译为表征性状态转移）。 它首次出现在2000年Roy Fielding的博士论文中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>数据的安全保障</span><br><span class="line"><span class="comment">#数据传输一般使用https协议进行传输</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>接口特征表现</span><br><span class="line"><span class="comment">#前后数据交互的接口需要在网址中写入api关键字，用于标识该地址是用于返回数据的</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>多数据版本共存</span><br><span class="line"><span class="comment">#应该将API的版本号放入URL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>路径</span><br><span class="line"><span class="comment">#在restful规范中指出，每一个路径应当看成一个资源，例如books路径就应该看成所有的图书信息</span></span><br><span class="line">    <span class="comment">#并且在设计路径的时候不要使用动词！</span></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>资源操作方式由请求决定</span><br><span class="line"><span class="comment">#我们在设计路径的时候不使用动词，这种时候我们就需要使用另外一种方式去判断该请求的目的。例如我们是对一本图书进行删除，增加等</span></span><br><span class="line"><span class="comment">#共有7种请求方式</span></span><br><span class="line">    常用：</span><br><span class="line">        GET（SELECT）：从服务器取出资源（一项或多项）。</span><br><span class="line">        POST（CREATE）：在服务器新建一个资源。</span><br><span class="line">        PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</span><br><span class="line">        PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</span><br><span class="line">        DELETE（DELETE）：从服务器删除资源</span><br><span class="line">    不常用：</span><br><span class="line">        HEAD：获取资源的元数据。</span><br><span class="line">        OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</span><br><span class="line">    </span><br><span class="line"><span class="number">6.</span>过滤，通过在url上传参的形式传递搜索条件</span><br><span class="line"><span class="comment">#我们可以通过url放回过滤参数。例如?limit=10指的是过滤出前10条</span></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>响应状态码</span><br><span class="line"><span class="comment">#服务器端向客户端返回数据的时候需要添加状态码</span></span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>错误处理，应当返回错误信息，error当做key</span><br><span class="line"><span class="comment">#服务器端对应不同的状态码应当返回对应的错误信息</span></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>返回结果，针对不同操作，服务器向用户返回的文档需要符合下述规范</span><br><span class="line">GET /collection：返回资源对象的列表（数组）</span><br><span class="line">    GET /collection/resource：返回单个资源对象</span><br><span class="line">    POST /collection：返回新生成的资源对象</span><br><span class="line">    PUT /collection/resource：返回完整的资源对象</span><br><span class="line">    PATCH /collection/resource：返回完整的资源对象</span><br><span class="line">    DELETE /collection/resource：返回一个空文档</span><br><span class="line"></span><br><span class="line"><span class="number">10</span>需要url请求的可以在返回结果中返回链接</span><br><span class="line"><span class="comment">#字面意思，若是前端的代码需要url连接的话在返回的json数据中携带url。例如图片的url</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;RESTful-API规范-10条&quot;&gt;&lt;a href=&quot;#RESTful-API规范-10条&quot; class=&quot;headerlink&quot; title=&quot;RESTful API规范(10条)&quot;&gt;&lt;/a&gt;RESTful API规范(10条)&lt;/h3&gt;&lt;p&gt;​    RES</summary>
      
    
    
    
    <category term="rest-framework" scheme="https://a744740454.github.io/categories/rest-framework/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="rest-framework" scheme="https://a744740454.github.io/tags/rest-framework/"/>
    
    <category term="drf" scheme="https://a744740454.github.io/tags/drf/"/>
    
    <category term="RESTful API" scheme="https://a744740454.github.io/tags/RESTful-API/"/>
    
  </entry>
  
  <entry>
    <title>drf序列化器</title>
    <link href="https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8/"/>
    <id>https://a744740454.github.io/2021/02/22/django/rest-framework/drf%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8/</id>
    <published>2021-02-22T10:25:41.294Z</published>
    <updated>2021-02-22T10:28:02.781Z</updated>
    
    <content type="html"><![CDATA[<h2 id="序列化器的各个字段以及字段内属性"><a href="#序列化器的各个字段以及字段内属性" class="headerlink" title="序列化器的各个字段以及字段内属性"></a>序列化器的各个字段以及字段内属性</h2><p>字段表格：</p><table><thead><tr><th><strong>BooleanField</strong></th><th>BooleanField()</th></tr></thead><tbody><tr><td><strong>NullBooleanField</strong></td><td>NullBooleanField()</td></tr><tr><td><strong>CharField</strong></td><td>CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</td></tr><tr><td><strong>EmailField</strong></td><td>EmailField(max_length=None, min_length=None, allow_blank=False)</td></tr><tr><td><strong>RegexField</strong></td><td>RegexField(regex, max_length=None, min_length=None, allow_blank=False)</td></tr><tr><td><strong>SlugField</strong></td><td>SlugField(max<em>length=50, min_length=None, allow_blank=False) 正则字段，验证正则模式 [a-zA-Z0-9</em>-]+</td></tr><tr><td><strong>URLField</strong></td><td>URLField(max_length=200, min_length=None, allow_blank=False)</td></tr><tr><td><strong>UUIDField</strong></td><td>UUIDField(format=’hex_verbose’) format: 1) <code>&#39;hex_verbose&#39;</code> 如<code>&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code> 2） <code>&#39;hex&#39;</code> 如 <code>&quot;5ce0e9a55ffa654bcee01238041fb31a&quot;</code> 3）<code>&#39;int&#39;</code> - 如: <code>&quot;123456789012312313134124512351145145114&quot;</code> 4）<code>&#39;urn&#39;</code> 如: <code>&quot;urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code></td></tr><tr><td><strong>IPAddressField</strong></td><td>IPAddressField(protocol=’both’, unpack_ipv4=False, **options)</td></tr><tr><td><strong>IntegerField</strong></td><td>IntegerField(max_value=None, min_value=None)</td></tr><tr><td><strong>FloatField</strong></td><td>FloatField(max_value=None, min_value=None)</td></tr><tr><td><strong>DecimalField</strong></td><td>DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None) max_digits: 最多位数 decimal_palces: 小数点位置</td></tr><tr><td><strong>DateTimeField</strong></td><td>DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)</td></tr><tr><td><strong>DateField</strong></td><td>DateField(format=api_settings.DATE_FORMAT, input_formats=None)</td></tr><tr><td><strong>TimeField</strong></td><td>TimeField(format=api_settings.TIME_FORMAT, input_formats=None)</td></tr><tr><td><strong>DurationField</strong></td><td>DurationField()</td></tr><tr><td><strong>ChoiceField</strong></td><td>ChoiceField(choices) choices与Django的用法相同</td></tr><tr><td><strong>MultipleChoiceField</strong></td><td>MultipleChoiceField(choices)</td></tr><tr><td><strong>FileField</strong></td><td>FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td></tr><tr><td><strong>ImageField</strong></td><td>ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td></tr><tr><td><strong>ListField</strong></td><td>ListField(child=, min_length=None, max_length=None)</td></tr><tr><td><strong>DictField</strong></td><td>DictField(child=)</td></tr></tbody></table><p>通用字段属性</p><table><thead><tr><th><strong>read_only</strong></th><th>表明该字段只会在返回数据的时候起到作用，并不会在写入数据的时候起到作用，默认False</th></tr></thead><tbody><tr><td><strong>write_only</strong></td><td>表明该字段只会在往数据库输入的时候起到作用，并不会在返回数据的时候将该字段数据返回，默认False</td></tr><tr><td><strong>required</strong></td><td>表明该字段在反序列化时必须输入，默认True</td></tr><tr><td><strong>default</strong></td><td>反序列化时使用的默认值</td></tr><tr><td><strong>allow_null</strong></td><td>表明该字段是否允许传入None，默认False</td></tr><tr><td><strong>validators</strong></td><td>可以使用该属性进行数据校验，为该属性传入的是一个列表，列表内放入函数的内存地址</td></tr><tr><td><strong>error_messages</strong></td><td>包含错误编号与错误信息的字典</td></tr><tr><td><strong>label</strong></td><td>用于HTML展示API页面时，显示的字段名称</td></tr><tr><td><strong>help_text</strong></td><td>用于HTML展示API页面时，显示的字段帮助提示信息</td></tr></tbody></table><p>非通用属性</p><table><thead><tr><th><strong>max_length</strong></th><th>最大长度</th></tr></thead><tbody><tr><td><strong>min_lenght</strong></td><td>最小长度</td></tr><tr><td><strong>allow_blank</strong></td><td>是否允许为空</td></tr><tr><td><strong>trim_whitespace</strong></td><td>是否截断空白字符</td></tr><tr><td><strong>max_value</strong></td><td>最小值</td></tr><tr><td><strong>min_value</strong></td><td>最大值</td></tr></tbody></table><h2 id="drf序列化器的全局钩子与局部钩子"><a href="#drf序列化器的全局钩子与局部钩子" class="headerlink" title="drf序列化器的全局钩子与局部钩子"></a>drf序列化器的全局钩子与局部钩子</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">局部钩子,validate_字段名，必须要有data,data就是form组件的clean_data</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_title</span>(<span class="params">self, data</span>):</span> </span><br><span class="line">    <span class="keyword">if</span> data.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;不能以sb开头&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        </span><br><span class="line">全局钩子,attrs就是form组件的clean_data</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">    title=attrs.get(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    publish=attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> title==publish:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名不能跟出版社同名&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">validators 字段中指定特定函数去处理检测</span><br><span class="line">publish = serializers.CharField(max_length=<span class="number">32</span>,validators=[check,])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data)&gt;<span class="number">10</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;最长不能超过10&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><h2 id="序列化器的高级使用"><a href="#序列化器的高级使用" class="headerlink" title="序列化器的高级使用"></a>序列化器的高级使用</h2><h3 id="1-source"><a href="#1-source" class="headerlink" title="1.source"></a>1.source</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>可以通过source与models中的字段进行映射关系，这样我们可以任意取名，为返回的数据命名</span><br><span class="line">book_name = serializers.CharField(min_length=<span class="number">3</span>, max_length=<span class="number">32</span>,source=<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>与models中的任意方法进行映射</span><br><span class="line">我们可以创建任意一个不存在的字段，与models中的任意函数进行映射</span><br><span class="line">    序列化器中</span><br><span class="line">    name_price = serializers.CharField(source=<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    models中：</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name + <span class="built_in">str</span>(self.price)</span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span>支持跨表查询数据</span><br><span class="line">    publish_addr = serializers.CharField(max_length=<span class="number">32</span> , source=<span class="string">&#x27;publish.addr&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="2-SerializerMethodField"><a href="#2-SerializerMethodField" class="headerlink" title="2.SerializerMethodField"></a>2.SerializerMethodField</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用该字段后，你可以在下面写一个方法与该字段进行绑定，下面的方法的返回值就是你这个字段要被序列化，反序列化的值</span><br><span class="line"><span class="comment">#命名规范</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_</span>字段名(<span class="params">self,obj</span>) #<span class="title">obj</span>是必须要有的，<span class="title">obj</span>为你这个类绑定的表的对象</span></span><br></pre></td></tr></table></figure><h2 id="模型类序列化器"><a href="#模型类序列化器" class="headerlink" title="模型类序列化器"></a>模型类序列化器</h2><h3 id="ModelSerilizer"><a href="#ModelSerilizer" class="headerlink" title="ModelSerilizer"></a>ModelSerilizer</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Book <span class="comment">#与model中的哪个表进行关联</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span> <span class="comment">#将哪些字段进行序列化或反序列化__all__是指全部序列化</span></span><br><span class="line">        exclude = [字段] <span class="comment">#除了哪些字段都进行序列化以及反序列化，不能跟fields同时使用</span></span><br><span class="line">        read_only_fields = [字段] <span class="comment">#只读与之前的read_only一样</span></span><br><span class="line">        write_only_fields = [字段] <span class="comment">#只写</span></span><br><span class="line">        extra_kwargs = &#123;字段:&#123;属性&#125;&#125; eg:&#123;<span class="string">&#x27;title&#x27;</span>:&#123;<span class="string">&#x27;max_length&#x27;</span>:<span class="number">32</span>,<span class="string">&#x27;write_only&#x27;</span>:<span class="literal">True</span>&#125;&#125;</span><br><span class="line">        depth = <span class="number">1</span> <span class="comment">#跨表查询，将另外一张与该表有关表的数据全部查出</span></span><br><span class="line">        </span><br><span class="line">新增与修改</span><br><span class="line">不需要重写create与update方法，在ModelSerializer以及进行了重写</span><br><span class="line"></span><br><span class="line">ps:值得注意的是，使用该序列器并对表进行关联后，当你调用is_valid()方法后，他会去帮助你检验数据库中的校验规则，比如用户名必须唯一等</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;序列化器的各个字段以及字段内属性&quot;&gt;&lt;a href=&quot;#序列化器的各个字段以及字段内属性&quot; class=&quot;headerlink&quot; title=&quot;序列化器的各个字段以及字段内属性&quot;&gt;&lt;/a&gt;序列化器的各个字段以及字段内属性&lt;/h2&gt;&lt;p&gt;字段表格：&lt;/p&gt;
&lt;tab</summary>
      
    
    
    
    <category term="rest-framework" scheme="https://a744740454.github.io/categories/rest-framework/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="rest-framework" scheme="https://a744740454.github.io/tags/rest-framework/"/>
    
    <category term="drf" scheme="https://a744740454.github.io/tags/drf/"/>
    
  </entry>
  
  <entry>
    <title>rest-framework初识</title>
    <link href="https://a744740454.github.io/2021/02/22/django/rest-framework/rest-framework%E5%88%9D%E8%AF%86/"/>
    <id>https://a744740454.github.io/2021/02/22/django/rest-framework/rest-framework%E5%88%9D%E8%AF%86/</id>
    <published>2021-02-22T06:59:44.310Z</published>
    <updated>2021-02-22T10:28:25.042Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是rest-framework"><a href="#什么是rest-framework" class="headerlink" title="什么是rest_framework"></a>什么是rest_framework</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rest_framework简称drf</span><br><span class="line">rest_framework是基于django与RESTful API规范设计的框架。</span><br></pre></td></tr></table></figure><h2 id="drf的简单使用"><a href="#drf的简单使用" class="headerlink" title="drf的简单使用"></a>drf的简单使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>安装</span><br><span class="line">pip install djangorestframework</span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>注册</span><br><span class="line">在django的配置文件中进行注册，drf本质是一个app,所以我们在注册app的地方注册即可</span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span>进行数据迁移</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line">    </span><br><span class="line"><span class="number">4.</span>新写一个序列化器类</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="comment">#写字段</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(read_only=<span class="literal">True</span>)</span><br><span class="line">    name = serializers.CharField(min_length=<span class="number">3</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    publish = serializers.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>视图函数中创建类，以及在路由中配置路由</span><br><span class="line"><span class="comment">#路由</span></span><br><span class="line">url(<span class="string">r&#x27;^books/&#x27;</span>, views.Books.as_view()),</span><br><span class="line"></span><br><span class="line"><span class="comment">#视图 返回的Response是drf的Response</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        books = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        book_ser = ser.Book(instance=books, many=<span class="literal">True</span>) <span class="comment"># 传入一个queryset对象，序列器会自动帮你转化为字典</span></span><br><span class="line">        <span class="keyword">return</span> Response(book_ser.data)</span><br><span class="line">    ps:序列器对象中的参数</span><br><span class="line">        many:若是多个对象要使该参数为true</span><br><span class="line">        instance:传入你实例化的对象</span><br><span class="line">        data:传入一个反序列化的数据</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;什么是rest-framework&quot;&gt;&lt;a href=&quot;#什么是rest-framework&quot; class=&quot;headerlink&quot; title=&quot;什么是rest_framework&quot;&gt;&lt;/a&gt;什么是rest_framework&lt;/h2&gt;&lt;figure class</summary>
      
    
    
    
    <category term="rest-framework" scheme="https://a744740454.github.io/categories/rest-framework/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="rest-framework" scheme="https://a744740454.github.io/tags/rest-framework/"/>
    
    <category term="drf" scheme="https://a744740454.github.io/tags/drf/"/>
    
  </entry>
  
  <entry>
    <title>web应用介绍</title>
    <link href="https://a744740454.github.io/2021/02/22/django/web%E5%BA%94%E7%94%A8%E4%BB%8B%E7%BB%8D/"/>
    <id>https://a744740454.github.io/2021/02/22/django/web%E5%BA%94%E7%94%A8%E4%BB%8B%E7%BB%8D/</id>
    <published>2021-02-22T06:47:24.537Z</published>
    <updated>2021-02-22T06:50:13.436Z</updated>
    
    <content type="html"><![CDATA[<h4 id="什么是web应用"><a href="#什么是web应用" class="headerlink" title="什么是web应用"></a>什么是web应用</h4><p>web应用是一种可以通过web访问的应用程序，用户只需要有浏览器即可，不需要安装其他软件</p><h4 id="什么是web框架"><a href="#什么是web框架" class="headerlink" title="什么是web框架"></a>什么是web框架</h4><p>web框架是一种开发框架，用于支持网络应用和网络服务的开发</p><h4 id="动静态网页的区别"><a href="#动静态网页的区别" class="headerlink" title="动静态网页的区别"></a>动静态网页的区别</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">动态网页：动态网页简单的说就是会随着用户的请求不同而改变内容的网页，一般会有一些后端的代码与前端代码进行交互</span><br><span class="line"></span><br><span class="line">静态网页：简单的说静态网页就是用户无论何时打开网页都是没有变化的，内容是固定的</span><br></pre></td></tr></table></figure><h4 id="python常用的三个web框架的区别"><a href="#python常用的三个web框架的区别" class="headerlink" title="python常用的三个web框架的区别"></a>python常用的三个web框架的区别</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#三个框架各自的特点</span></span><br><span class="line">Django:</span><br><span class="line">    大而全，集成了很多组件，有些笨重</span><br><span class="line">Flask:</span><br><span class="line">    小而轻，原生组件几乎为<span class="number">0</span>，但是第三方库极多</span><br><span class="line">Tornado:</span><br><span class="line">    原生的异步非阻塞框架，在处理并发的任务上十分的优秀</span><br></pre></td></tr></table></figure><h4 id="MVC与MTV"><a href="#MVC与MTV" class="headerlink" title="MVC与MTV"></a>MVC与MTV</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MVC:一般市面上的web框架就是MVC框架的，他们将一个web应用分解成三部分，已达到解耦合的目的</span><br><span class="line">M:Models(模板层)用于和数据库打交道</span><br><span class="line">    V:View(视图层)负责与用户进行交互</span><br><span class="line">    C:Controller(控制层)进行逻辑处理的一层</span><br><span class="line">MTV:Django的web模式，本质还是MVC模式</span><br><span class="line">M:models(模型层)  与数据库交互</span><br><span class="line">    T:template(模板层)与用户交互</span><br><span class="line">    V:view(视图函数)  进行逻辑处理</span><br><span class="line">ps：MVC与MTV最大的区别就是MTV将MVC的C又进行了一层拆分，分出了一个urls专门用于处理路由匹配的问题，MVC的路由匹配则是直接在Controller中处理的</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;什么是web应用&quot;&gt;&lt;a href=&quot;#什么是web应用&quot; class=&quot;headerlink&quot; title=&quot;什么是web应用&quot;&gt;&lt;/a&gt;什么是web应用&lt;/h4&gt;&lt;p&gt;web应用是一种可以通过web访问的应用程序，用户只需要有浏览器即可，不需要安装其他软件&lt;/</summary>
      
    
    
    
    <category term="django" scheme="https://a744740454.github.io/categories/django/"/>
    
    
    <category term="django" scheme="https://a744740454.github.io/tags/django/"/>
    
    <category term="web应用" scheme="https://a744740454.github.io/tags/web%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>flask的简单使用</title>
    <link href="https://a744740454.github.io/2021/02/14/flask/flask/"/>
    <id>https://a744740454.github.io/2021/02/14/flask/flask/</id>
    <published>2021-02-14T06:32:37.707Z</published>
    <updated>2021-02-23T11:31:45.686Z</updated>
    
    <content type="html"><![CDATA[<h2 id="flask的简单使用"><a href="#flask的简单使用" class="headerlink" title="flask的简单使用"></a>flask的简单使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>安装flask</span><br><span class="line">pip install flask</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>新建一个py项目，并实例化获得一个flask对象</span><br><span class="line">eg:</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>写一个函数</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>启动服务</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,port=<span class="number">4000</span>)</span><br></pre></td></tr></table></figure><h2 id="flask返回页面"><a href="#flask返回页面" class="headerlink" title="flask返回页面"></a>flask返回页面</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>重定向</span><br><span class="line"><span class="number">1.</span>导入redirect</span><br><span class="line">    <span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="number">2.</span>在对应的函数中返回</span><br><span class="line"><span class="meta">        @app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">            <span class="keyword">return</span> redirect()</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>直接返回字符串</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;任意字符&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>返回模板</span><br><span class="line"><span class="number">1.</span>导入render_template</span><br><span class="line">    <span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line">    <span class="number">2.</span>返回</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>返回json格式字符串</span><br><span class="line"><span class="number">1.</span>导入jsonify</span><br><span class="line">    <span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line">    <span class="number">2.</span>返回</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,&#125;)</span><br></pre></td></tr></table></figure><h2 id="flask函数中使用反向解析"><a href="#flask函数中使用反向解析" class="headerlink" title="flask函数中使用反向解析"></a>flask函数中使用反向解析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在django中我们若要在函数中使用反向解析，我们使用的是reverse,而flask中则是url_for</span><br><span class="line">参数:</span><br><span class="line">    endpoint --函数别名</span><br></pre></td></tr></table></figure><h2 id="flask的配置文件"><a href="#flask的配置文件" class="headerlink" title="flask的配置文件"></a>flask的配置文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">flask使用配置文件有多种方式</span><br><span class="line"><span class="number">1.</span>直接针对flask的对象进行配置，但是只能配两种</span><br><span class="line">app=Flask(__name__)</span><br><span class="line">app.secret_key=<span class="string">&#x27;asdfasdfasdf4545322wefaaeaesfsad&#x27;</span></span><br><span class="line">app.debug=<span class="literal">True</span>  <span class="comment"># 调试模式</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>给对象的config设置，可以设置所有配置文件</span><br><span class="line">app.config[<span class="string">&#x27;DEBUG&#x27;</span>]=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>通过配置文件进行配置</span><br><span class="line">app.config.from_pyfile(<span class="string">&quot;settings.py&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>通过环境变量进行配置</span><br><span class="line">os.environ[<span class="string">&#x27;DEBUG&#x27;</span>]=<span class="string">&#x27;ddd&#x27;</span></span><br><span class="line">app.config.from_envvar(os.environ[<span class="string">&#x27;DEBUG&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>通过json格式文件进行配置</span><br><span class="line">app.config.from_json(<span class="string">&quot;setting.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>通过字典进行配置</span><br><span class="line">app.config.from_mapping(&#123;<span class="string">&#x27;DEBUG&#x27;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>通过类配置</span><br><span class="line">app.config.from_object(<span class="string">&#x27;settings.ProductionConfig&#x27;</span>) <span class="comment">#在settings文件夹中写一个类即可</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    DEBUG = <span class="literal">False</span></span><br><span class="line">    TESTING = <span class="literal">False</span></span><br><span class="line">    DATABASE_URI = <span class="string">&#x27;xxxx&#x27;</span></span><br><span class="line">    USER=<span class="string">&#x27;root&#x27;</span></span><br><span class="line">    PASSWORD=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductionConfig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    DATABASE_URI = <span class="string">&#x27;mysql://user@localhost/foo&#x27;</span></span><br><span class="line">    USER = <span class="string">&#x27;luffy&#x27;</span></span><br><span class="line">    PASSWORD = <span class="string">&#x27;luffy?&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="flask的默认配置"><a href="#flask的默认配置" class="headerlink" title="flask的默认配置"></a>flask的默认配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="string">&#x27;DEBUG&#x27;</span>:                                get_debug_flag(default=<span class="literal">False</span>),  是否开启Debug模式</span><br><span class="line">        <span class="string">&#x27;TESTING&#x27;</span>:                              <span class="literal">False</span>,                          是否开启测试模式</span><br><span class="line">        <span class="string">&#x27;PROPAGATE_EXCEPTIONS&#x27;</span>:                 <span class="literal">None</span>,                          </span><br><span class="line">        <span class="string">&#x27;PRESERVE_CONTEXT_ON_EXCEPTION&#x27;</span>:        <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SECRET_KEY&#x27;</span>:                           <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>:           timedelta(days=<span class="number">31</span>),</span><br><span class="line">        <span class="string">&#x27;USE_X_SENDFILE&#x27;</span>:                       <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;LOGGER_NAME&#x27;</span>:                          <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;LOGGER_HANDLER_POLICY&#x27;</span>:               <span class="string">&#x27;always&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_NAME&#x27;</span>:                          <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;APPLICATION_ROOT&#x27;</span>:                     <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_NAME&#x27;</span>:                  <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_DOMAIN&#x27;</span>:                <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_PATH&#x27;</span>:                  <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_HTTPONLY&#x27;</span>:              <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_SECURE&#x27;</span>:                <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_REFRESH_EACH_REQUEST&#x27;</span>:         <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>:                   <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;</span>:            timedelta(hours=<span class="number">12</span>),</span><br><span class="line">        <span class="string">&#x27;TRAP_BAD_REQUEST_ERRORS&#x27;</span>:              <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;TRAP_HTTP_EXCEPTIONS&#x27;</span>:                 <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;EXPLAIN_TEMPLATE_LOADING&#x27;</span>:             <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;PREFERRED_URL_SCHEME&#x27;</span>:                 <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;JSON_AS_ASCII&#x27;</span>:                        <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;JSON_SORT_KEYS&#x27;</span>:                       <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;</span>:          <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;JSONIFY_MIMETYPE&#x27;</span>:                     <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;TEMPLATES_AUTO_RELOAD&#x27;</span>:                <span class="literal">None</span>,</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="flask默认拥有的转换器"><a href="#flask默认拥有的转换器" class="headerlink" title="flask默认拥有的转换器"></a>flask默认拥有的转换器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_CONVERTERS = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>:          UnicodeConverter,  <span class="comment">#默认不填属性时设置的</span></span><br><span class="line">    <span class="string">&#x27;string&#x27;</span>:           UnicodeConverter,</span><br><span class="line">    <span class="string">&#x27;any&#x27;</span>:              AnyConverter,</span><br><span class="line">    <span class="string">&#x27;path&#x27;</span>:             PathConverter,</span><br><span class="line">    <span class="string">&#x27;int&#x27;</span>:              IntegerConverter,</span><br><span class="line">    <span class="string">&#x27;float&#x27;</span>:            FloatConverter,</span><br><span class="line">    <span class="string">&#x27;uuid&#x27;</span>:             UUIDConverter,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;flask的简单使用&quot;&gt;&lt;a href=&quot;#flask的简单使用&quot; class=&quot;headerlink&quot; title=&quot;flask的简单使用&quot;&gt;&lt;/a&gt;flask的简单使用&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;</summary>
      
    
    
    
    <category term="flask" scheme="https://a744740454.github.io/categories/flask/"/>
    
    
    <category term="flask" scheme="https://a744740454.github.io/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>scrapy提高爬取效率</title>
    <link href="https://a744740454.github.io/2021/02/12/%E7%88%AC%E8%99%AB/scrapy/scrapy%E6%8F%90%E9%AB%98%E7%88%AC%E5%8F%96%E6%95%88%E7%8E%87/"/>
    <id>https://a744740454.github.io/2021/02/12/%E7%88%AC%E8%99%AB/scrapy/scrapy%E6%8F%90%E9%AB%98%E7%88%AC%E5%8F%96%E6%95%88%E7%8E%87/</id>
    <published>2021-02-12T05:46:12.545Z</published>
    <updated>2021-02-16T04:20:06.509Z</updated>
    
    <content type="html"><![CDATA[<h2 id="提高爬虫效率"><a href="#提高爬虫效率" class="headerlink" title="提高爬虫效率"></a>提高爬虫效率</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 提高scrapy的爬取效率（异步框架，基于twisted，性能很高了，可以优化的点），面试聊</span><br><span class="line"></span><br><span class="line">- 在配置文件中进行相关的配置即可:(默认还有一套setting，类比django)</span><br><span class="line"><span class="comment">#1 增加并发：</span></span><br><span class="line">默认scrapy开启的并发线程为<span class="number">32</span>个，可以适当进行增加。在settings配置文件中修改CONCURRENT_REQUESTS = <span class="number">100</span>值为<span class="number">100</span>,并发设置成了为<span class="number">100</span>。</span><br><span class="line">CONCURRENT_REQUESTS = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 降低日志级别：</span></span><br><span class="line">在运行scrapy时，会有大量日志信息的输出，为了减少CPU的使用率。可以设置log输出信息为INFO或者ERROR即可。在配置文件中编写：LOG_LEVEL = ‘INFO’</span><br><span class="line"><span class="comment"># 3 禁止cookie：（cnblogs不需要cookie）</span></span><br><span class="line">如果不是真的需要cookie，则在scrapy爬取数据时可以禁止cookie从而减少CPU的使用率，提升爬取效率。在配置文件中编写：COOKIES_ENABLED = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 4禁止重试：</span></span><br><span class="line">对失败的HTTP进行重新请求（重试）会减慢爬取速度，因此可以禁止重试。在配置文件中编写：</span><br><span class="line">RETRY_ENABLED = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 5 减少下载超时：</span></span><br><span class="line">如果对一个非常慢的链接进行爬取，减少下载超时可以能让卡住的链接快速被放弃，从而提升效率。在配置文件中进行编写：</span><br><span class="line">DOWNLOAD_TIMEOUT = <span class="number">10</span> 超时时间为10s</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;提高爬虫效率&quot;&gt;&lt;a href=&quot;#提高爬虫效率&quot; class=&quot;headerlink&quot; title=&quot;提高爬虫效率&quot;&gt;&lt;/a&gt;提高爬虫效率&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gu</summary>
      
    
    
    
    <category term="scrapy" scheme="https://a744740454.github.io/categories/scrapy/"/>
    
    
    <category term="爬虫" scheme="https://a744740454.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
    <category term="scrapy" scheme="https://a744740454.github.io/tags/scrapy/"/>
    
  </entry>
  
  <entry>
    <title>scrapy的Request与Item对象</title>
    <link href="https://a744740454.github.io/2021/02/12/%E7%88%AC%E8%99%AB/scrapy/scrapy%E7%9A%84Response%E4%B8%8Eitem/"/>
    <id>https://a744740454.github.io/2021/02/12/%E7%88%AC%E8%99%AB/scrapy/scrapy%E7%9A%84Response%E4%B8%8Eitem/</id>
    <published>2021-02-12T05:19:34.262Z</published>
    <updated>2021-02-16T04:19:57.584Z</updated>
    
    <content type="html"><![CDATA[<h2 id="scrapy的Request与item"><a href="#scrapy的Request与item" class="headerlink" title="scrapy的Request与item"></a>scrapy的Request与item</h2><h3 id="Request对象"><a href="#Request对象" class="headerlink" title="Request对象"></a>Request对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">导入位置</span><br><span class="line"><span class="keyword">from</span> scrapy.http.request <span class="keyword">import</span> Request</span><br><span class="line">参数:</span><br><span class="line">url       ---  一个网址，<span class="keyword">yield</span>住之后下次爬取的地址</span><br><span class="line">callback  ---  函数名，当request请求爬取回来之后执行的函数</span><br><span class="line">meta      ---  request与回调函数之间传递参数使用，传字典</span><br></pre></td></tr></table></figure><h3 id="Item对象"><a href="#Item对象" class="headerlink" title="Item对象"></a>Item对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>导入</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Item</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>自己写一个类并且继承Item类</span><br><span class="line">eg:</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstscrapyItem</span>(<span class="params">scrapy.Item</span>):</span></span><br><span class="line">    name = scrapy.Field()</span><br><span class="line">    </span><br><span class="line">当你在程序中<span class="keyword">yield</span>住一个Item对象之后，程序便会自动去保存</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>在爬虫程序中每爬取一页都实例化一个对象</span><br><span class="line">item = FirstscrapyItem()</span><br><span class="line">ps:往这个对象中存值只能使用[]的方式，不能用.</span><br><span class="line">eg:item[<span class="string">&#x27;url&#x27;</span>] = url</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span><span class="keyword">yield</span>返回该值即可，接下来他会根据settings中的配置去pipline中找到对应的类并进行持久化存储</span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;firstscrapy.pipelines.FirstscrapyPipeline&#x27;</span>: <span class="number">300</span>, <span class="comment">#类的位置，后面的数字是优先级</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数据的持久化操作"><a href="#数据的持久化操作" class="headerlink" title="数据的持久化操作"></a>数据的持久化操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.使用命令</span><br><span class="line">我们只需要在执行文件后添加一个-o 路径即可</span><br><span class="line">eg:scrapy crawl first -o .&#x2F;qiubai.csv</span><br><span class="line">以该方式存储的只能为&#39;json&#39;, &#39;jsonlines&#39;, &#39;jl&#39;, &#39;csv&#39;, &#39;xml&#39;, &#39;marshal&#39;, &#39;pickle&#39;这些格式</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;scrapy的Request与item&quot;&gt;&lt;a href=&quot;#scrapy的Request与item&quot; class=&quot;headerlink&quot; title=&quot;scrapy的Request与item&quot;&gt;&lt;/a&gt;scrapy的Request与item&lt;/h2&gt;&lt;h3 i</summary>
      
    
    
    
    <category term="scrapy" scheme="https://a744740454.github.io/categories/scrapy/"/>
    
    
    <category term="爬虫" scheme="https://a744740454.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
    <category term="scrapy" scheme="https://a744740454.github.io/tags/scrapy/"/>
    
  </entry>
  
  <entry>
    <title>celery在linux的后台运行</title>
    <link href="https://a744740454.github.io/2021/02/05/celery/celery%E5%9C%A8linux%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/"/>
    <id>https://a744740454.github.io/2021/02/05/celery/celery%E5%9C%A8linux%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/</id>
    <published>2021-02-05T06:05:55.775Z</published>
    <updated>2021-02-16T02:14:27.420Z</updated>
    
    <content type="html"><![CDATA[<h2 id="celery部署到服务器上"><a href="#celery部署到服务器上" class="headerlink" title="celery部署到服务器上"></a>celery部署到服务器上</h2><p>当我们写了一个celery的定时任务之后，我们需要将其放到我们服务器上并让其在后台执行。</p><p>我本来是直接部署到服务器上，然后执行了两句命令，但是没想到确失败了。经过一番资料的查找，我发现需要用到两个命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&amp;      -- 这个符号可以让你的程序在后台运行</span><br><span class="line">nohup  -- 这个命令可以让你的程序在你退出ssh链接之后不被杀死</span><br><span class="line">eg:</span><br><span class="line">nohup .&#x2F;start-dishi.sh &gt;output 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line"> 1. &amp;符号的含义</span><br><span class="line"> 带&amp;的命令行，即使terminal（终端）关闭，或者电脑死机程序依然运行（前提是你把程序递交到服务器上)； </span><br><span class="line"> 2. 2&gt;&amp;1的意思 </span><br><span class="line">　　这个意思是把标准错误（2）重定向到标准输出中（1），而标准输出又导入文件output里面，所以结果是标准错误和标准输出都导入文件output里面了。 至于为什么需要将标准错误重定向到标准输出的原因，那就归结为标准错误没有缓冲区，而stdout有。这就会导致 &gt;output 2&gt;output 文件output被两次打开，而stdout和stderr将会竞争覆盖，这肯定不是我门想要的. </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;celery部署到服务器上&quot;&gt;&lt;a href=&quot;#celery部署到服务器上&quot; class=&quot;headerlink&quot; title=&quot;celery部署到服务器上&quot;&gt;&lt;/a&gt;celery部署到服务器上&lt;/h2&gt;&lt;p&gt;当我们写了一个celery的定时任务之后，我们需要将</summary>
      
    
    
    
    <category term="celery学习" scheme="https://a744740454.github.io/categories/celery%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="celery,linux" scheme="https://a744740454.github.io/tags/celery-linux/"/>
    
  </entry>
  
  <entry>
    <title>五险一金相关</title>
    <link href="https://a744740454.github.io/2021/02/02/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/%E4%BA%94%E9%99%A9%E4%B8%80%E9%87%91%E7%9B%B8%E5%85%B3/"/>
    <id>https://a744740454.github.io/2021/02/02/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/%E4%BA%94%E9%99%A9%E4%B8%80%E9%87%91%E7%9B%B8%E5%85%B3/</id>
    <published>2021-02-02T00:28:07.897Z</published>
    <updated>2021-02-02T01:02:42.077Z</updated>
    
    <content type="html"><![CDATA[<h2 id="五险一金是指哪些？"><a href="#五险一金是指哪些？" class="headerlink" title="五险一金是指哪些？"></a>五险一金是指哪些？</h2><p>五险:养老，医疗，失业，生育，工伤</p><p>一金:公积金</p><h2 id="个人账户与统筹账户"><a href="#个人账户与统筹账户" class="headerlink" title="个人账户与统筹账户"></a>个人账户与统筹账户</h2><p>五险的账户会分为2部分，一部分为个人账户，一部分为统筹账户</p><p>个人账户:从你工资上扣的</p><p>统筹账户:从公司中扣的,与员工无关</p><h2 id="社保基数是多少？"><a href="#社保基数是多少？" class="headerlink" title="社保基数是多少？"></a>社保基数是多少？</h2><p> 社会保险基数简称社保基数，是指职工在一个社保年度的社会保险缴费基数。它是按照职工上一年度1月至12月的所有工资性收入所得的月平均额来进行确定。社会保险缴费基数是计算用人单位及其职工缴纳社保费和职工社会保险待遇的重要依据，有上限和下限之分，具体数额根据各地区实际情况而定。</p><p>建议:够用即可</p><h2 id="社保可以取得前提"><a href="#社保可以取得前提" class="headerlink" title="社保可以取得前提"></a>社保可以取得前提</h2><pre><code> -死亡</code></pre><p>​    -移民</p><p>​    -转移</p><h2 id="公积金"><a href="#公积金" class="headerlink" title="公积金"></a>公积金</h2><p>​    -这个能多交就多交(5%–12%),你交一半，公司给你交一半，可以随时提取</p><p>​    -租房子，新房装修等都可以提取</p><h2 id="面试技巧"><a href="#面试技巧" class="headerlink" title="面试技巧"></a>面试技巧</h2><p>1.现在全国的社保是没有进行全国联网的，因此若hr问你之前有没有交过社保，可以使用下面这句话</p><p>​    -我之前在上海没有交过社保，你给我办增员</p><p>2.工作经验三年，没有交过社保</p><p>​    -之前是在别的城市工作</p><p>​    -跟之前的同事合伙办了个公司</p><p>​    -去了个创业公司(公司没给交)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;五险一金是指哪些？&quot;&gt;&lt;a href=&quot;#五险一金是指哪些？&quot; class=&quot;headerlink&quot; title=&quot;五险一金是指哪些？&quot;&gt;&lt;/a&gt;五险一金是指哪些？&lt;/h2&gt;&lt;p&gt;五险:养老，医疗，失业，生育，工伤&lt;/p&gt;
&lt;p&gt;一金:公积金&lt;/p&gt;
&lt;h2 id</summary>
      
    
    
    
    <category term="五险一金" scheme="https://a744740454.github.io/categories/%E4%BA%94%E9%99%A9%E4%B8%80%E9%87%91/"/>
    
    
    <category term="五险一金" scheme="https://a744740454.github.io/tags/%E4%BA%94%E9%99%A9%E4%B8%80%E9%87%91/"/>
    
  </entry>
  
  <entry>
    <title>gitpython学习</title>
    <link href="https://a744740454.github.io/2021/01/20/python%E6%A8%A1%E5%9D%97/gitpython/gitpython/"/>
    <id>https://a744740454.github.io/2021/01/20/python%E6%A8%A1%E5%9D%97/gitpython/gitpython/</id>
    <published>2021-01-20T11:34:32.932Z</published>
    <updated>2021-01-20T12:57:11.304Z</updated>
    
    
    
    
    <category term="gitpython" scheme="https://a744740454.github.io/categories/gitpython/"/>
    
    
    <category term="自动化" scheme="https://a744740454.github.io/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    <category term="gitpython" scheme="https://a744740454.github.io/tags/gitpython/"/>
    
    <category term="python模块" scheme="https://a744740454.github.io/tags/python%E6%A8%A1%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>celery的高级使用</title>
    <link href="https://a744740454.github.io/2021/01/20/celery/celery%E7%9A%84%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8/"/>
    <id>https://a744740454.github.io/2021/01/20/celery/celery%E7%9A%84%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8/</id>
    <published>2021-01-20T09:06:53.858Z</published>
    <updated>2021-02-05T05:18:53.716Z</updated>
    
    <content type="html"><![CDATA[<h2 id="celery的高级使用"><a href="#celery的高级使用" class="headerlink" title="celery的高级使用"></a>celery的高级使用</h2><p>前面两篇博客主要讲的是celery的基本使用方式以及常用的目录结构。这一篇主要讲celery定时任务的使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">其实celery定时任务非常的简单，我们只需要在celery实例化的那个文件夹中进行一些配置即可</span><br><span class="line">然后使用下述命令启动自动提交任务的服务:</span><br><span class="line">celery beat -A celery_task -l info</span><br><span class="line">celery worker -A celery_task -l info -P eventlet</span><br><span class="line"></span><br><span class="line">实例:</span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line">broker = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span></span><br><span class="line">backend = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span></span><br><span class="line">app = Celery(broker=broker, backend=backend, include=[<span class="string">&#x27;celery_task.tasks&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区</span></span><br><span class="line">app.conf.timezone = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="comment"># 是否使用UTC</span></span><br><span class="line">app.conf.enable_utc = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务的定时配置</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line">app.conf.beat_schedule = &#123;</span><br><span class="line">    <span class="string">&#x27;low-task&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;celery_task.tasks.low&#x27;</span>,               <span class="comment">#任务的位置</span></span><br><span class="line">        <span class="string">&#x27;schedule&#x27;</span>: timedelta(seconds=<span class="number">3</span>),              <span class="comment">#距离执行的时间，放一个时间对象</span></span><br><span class="line">        <span class="comment"># &#x27;schedule&#x27;: crontab(hour=8, day_of_week=1),  # 每周一早八点</span></span><br><span class="line">        <span class="string">&#x27;args&#x27;</span>: (<span class="number">300</span>, <span class="number">150</span>),                            <span class="comment">#任务所需的参数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按上述方式进行配置后，我们便不需要使用delay去提交任务，而是一到执行时间celery便会自动执行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;celery的高级使用&quot;&gt;&lt;a href=&quot;#celery的高级使用&quot; class=&quot;headerlink&quot; title=&quot;celery的高级使用&quot;&gt;&lt;/a&gt;celery的高级使用&lt;/h2&gt;&lt;p&gt;前面两篇博客主要讲的是celery的基本使用方式以及常用的目录结构。</summary>
      
    
    
    
    <category term="celery学习" scheme="https://a744740454.github.io/categories/celery%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="celery" scheme="https://a744740454.github.io/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>celery多任务结构</title>
    <link href="https://a744740454.github.io/2021/01/20/celery/celery%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9E%84/"/>
    <id>https://a744740454.github.io/2021/01/20/celery/celery%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9E%84/</id>
    <published>2021-01-20T08:51:54.755Z</published>
    <updated>2021-01-21T04:18:22.298Z</updated>
    
    <content type="html"><![CDATA[<h2 id="celery多任务结构"><a href="#celery多任务结构" class="headerlink" title="celery多任务结构"></a>celery多任务结构</h2><p>上一篇博客我们简单的介绍了celery的简单使用，但是为了方便管理，我们一般不采用单文件的形式去使用celery，而是采用包的形式去管理clery任务</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">celery多任务结构</span><br><span class="line"></span><br><span class="line">project <span class="comment">#项目根目录</span></span><br><span class="line">    ├── celery_task  <span class="comment"># celery包</span></span><br><span class="line">    │   ├── __init__.py <span class="comment"># 包文件</span></span><br><span class="line">    │   ├── celery.py   <span class="comment"># celery连接和配置相关文件，且名字必须叫celery.py</span></span><br><span class="line">    │   └── tasks.py    <span class="comment"># 所有任务函数</span></span><br><span class="line">    ├── add_task.py  <span class="comment"># 添加任务</span></span><br><span class="line">    └── get_result.py   <span class="comment"># 获取结果</span></span><br></pre></td></tr></table></figure><h3 id="celery-py"><a href="#celery-py" class="headerlink" title="celery.py"></a>celery.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该文件一般就用于实例化获得celery对象，以及进行配置</span></span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line">broker = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span></span><br><span class="line">backend = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span></span><br><span class="line">app = Celery(broker=broker, backend=backend, include=[<span class="string">&#x27;celery_task.tasks&#x27;</span>])</span><br><span class="line"></span><br><span class="line">ps:include参数的内容写的是celery任务的文件位置，可以填写多个</span><br></pre></td></tr></table></figure><h3 id="tasks-py"><a href="#tasks-py" class="headerlink" title="tasks.py"></a>tasks.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该文件用于存放任务</span></span><br><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">n, m</span>):</span></span><br><span class="line">    print(n)</span><br><span class="line">    print(m)</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    print(<span class="string">&#x27;n+m的结果：%s&#x27;</span> % (n + m))</span><br><span class="line">    <span class="keyword">return</span> n + m</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">low</span>(<span class="params">n, m</span>):</span></span><br><span class="line">    print(n)</span><br><span class="line">    print(m)</span><br><span class="line">    print(<span class="string">&#x27;n-m的结果：%s&#x27;</span> % (n - m))</span><br><span class="line">    <span class="keyword">return</span> n - m</span><br></pre></td></tr></table></figure><h3 id="add-task-py"><a href="#add-task-py" class="headerlink" title="add_task.py"></a>add_task.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该文件用于提交任务</span></span><br><span class="line"><span class="keyword">from</span> celery_task <span class="keyword">import</span> tasks</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加立即执行任务</span></span><br><span class="line">t1 = tasks.add.delay(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">t2 = tasks.low.delay(<span class="number">100</span>, <span class="number">50</span>)</span><br><span class="line">print(t1.<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加延迟任务</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line">eta=datetime.utcnow() + timedelta(seconds=<span class="number">10</span>)</span><br><span class="line">tasks.low.apply_async(args=(<span class="number">200</span>, <span class="number">50</span>), eta=eta)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="get-result-py"><a href="#get-result-py" class="headerlink" title="get_result.py"></a>get_result.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该文件用于获取特定任务的运行结果</span></span><br><span class="line"><span class="keyword">from</span> celery_task.celery <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> celery.result <span class="keyword">import</span> AsyncResult</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="string">&#x27;21325a40-9d32-44b5-a701-9a31cc3c74b5&#x27;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">async</span> = AsyncResult(<span class="built_in">id</span>=<span class="built_in">id</span>, app=app)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">async</span>.successful():</span><br><span class="line">        result = <span class="keyword">async</span>.get()</span><br><span class="line">        print(result)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">async</span>.failed():</span><br><span class="line">        print(<span class="string">&#x27;任务失败&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">async</span>.status == <span class="string">&#x27;PENDING&#x27;</span>:</span><br><span class="line">        print(<span class="string">&#x27;任务等待中被执行&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">async</span>.status == <span class="string">&#x27;RETRY&#x27;</span>:</span><br><span class="line">        print(<span class="string">&#x27;任务异常后正在重试&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">async</span>.status == <span class="string">&#x27;STARTED&#x27;</span>:</span><br><span class="line">        print(<span class="string">&#x27;任务已经开始被执行&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;celery多任务结构&quot;&gt;&lt;a href=&quot;#celery多任务结构&quot; class=&quot;headerlink&quot; title=&quot;celery多任务结构&quot;&gt;&lt;/a&gt;celery多任务结构&lt;/h2&gt;&lt;p&gt;上一篇博客我们简单的介绍了celery的简单使用，但是为了方便管理，</summary>
      
    
    
    
    <category term="celery学习" scheme="https://a744740454.github.io/categories/celery%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="celery" scheme="https://a744740454.github.io/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>celery简单使用</title>
    <link href="https://a744740454.github.io/2021/01/20/celery/celery%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://a744740454.github.io/2021/01/20/celery/celery%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</id>
    <published>2021-01-20T07:30:51.655Z</published>
    <updated>2021-01-21T04:18:25.827Z</updated>
    
    <content type="html"><![CDATA[<h2 id="celery是什么"><a href="#celery是什么" class="headerlink" title="celery是什么"></a>celery是什么</h2><p>Celery是一个简单、灵活且可靠的，处理大量消息的分布式系统</p><p>专注于实时处理的异步任务队列</p><p>同时也支持任务调度</p><h2 id="celery的工作流程"><a href="#celery的工作流程" class="headerlink" title="celery的工作流程"></a>celery的工作流程</h2><p>1.从消息中间件中取出任务</p><p>2.在任务执行单元中执行任务</p><p>3.将任务执行的结果进行存储</p><p>celery本身不提供消息中间件以及存储任务，但是可以简单的集合第三方提供的服务。我们一般可以选择redis作为执行任务的第三方程序</p><h2 id="celery简单使用"><a href="#celery简单使用" class="headerlink" title="celery简单使用"></a>celery简单使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>安装</span><br><span class="line">pip install celery</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>导入后实例化获得一个对象</span><br><span class="line">cel_obj = celery.Celery() <span class="comment">#这里面有很多参数简单的说几个必要的</span></span><br><span class="line">参数:</span><br><span class="line">    main     <span class="comment">#任务名</span></span><br><span class="line">    backend  <span class="comment">#存放数据结果的位置</span></span><br><span class="line">    broker   <span class="comment">#存放任务的位置</span></span><br><span class="line"></span><br><span class="line">实例:</span><br><span class="line"><span class="keyword">import</span> celery</span><br><span class="line">backend = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span> <span class="comment">#存放结果的位置</span></span><br><span class="line">broker = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span> <span class="comment">#存放任务的位置</span></span><br><span class="line">cel_obj = celery.Celery(<span class="string">&#x27;test&#x27;</span>,backend=backend,broker=broker)</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用装饰器的方法将下面的任务管理起来</span></span><br><span class="line"><span class="meta">@cel_obj.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>在终端中输入命令启动celery服务</span><br><span class="line">celery -A 你celery实例化的那个文件 worker --loglevel=info</span><br><span class="line">eg:</span><br><span class="line">celery -A celery_study worker --loglevel=info</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>接下来你只要对那些被管理的命令使用delay()方法，这些任务就会被提交到，产生的结果也会放到对应位置</span><br><span class="line"><span class="keyword">from</span> celery_study <span class="keyword">import</span> test</span><br><span class="line">test.delay(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">#提交test任务</span></span><br><span class="line"> </span><br><span class="line">ps:windos上若启动celery服务出错可以先安装eventlet,然后在命令后添加一个-p参数使用</span><br><span class="line">pip3 install eventlet</span><br><span class="line">celery worker -A celery_task -l info -P eventlet</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;celery是什么&quot;&gt;&lt;a href=&quot;#celery是什么&quot; class=&quot;headerlink&quot; title=&quot;celery是什么&quot;&gt;&lt;/a&gt;celery是什么&lt;/h2&gt;&lt;p&gt;Celery是一个简单、灵活且可靠的，处理大量消息的分布式系统&lt;/p&gt;
&lt;p&gt;专注于</summary>
      
    
    
    
    <category term="celery学习" scheme="https://a744740454.github.io/categories/celery%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="celery" scheme="https://a744740454.github.io/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>python后端项目上线</title>
    <link href="https://a744740454.github.io/2021/01/19/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/python%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/"/>
    <id>https://a744740454.github.io/2021/01/19/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/python%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/</id>
    <published>2021-01-19T11:03:20.998Z</published>
    <updated>2021-01-19T11:42:37.430Z</updated>
    
    <content type="html"><![CDATA[<h2 id="后端项目上线"><a href="#后端项目上线" class="headerlink" title="后端项目上线"></a>后端项目上线</h2><p>python的后端上线由于操作还是比较繁琐的，因此我们把他单独拉出来讲</p><h3 id="更换配置文件"><a href="#更换配置文件" class="headerlink" title="更换配置文件"></a>更换配置文件</h3><p>在此之前我们一直使用的都是测试的配置文件，上线前我们需要改成上线的配置文件，并修改几个文件</p><p><strong>prod.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭测试环境</span></span><br><span class="line">DEBUG = <span class="literal">False</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改成你的公网ip地址</span></span><br><span class="line">ALLOWED_HOSTS = [</span><br><span class="line">    <span class="string">&#x27;39.99.192.127&#x27;</span>  </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许跨域</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#支付宝的回调的前后端接口地址</span></span><br><span class="line">BASE_URL = <span class="string">&#x27;http://39.99.192.127:8000&#x27;</span></span><br><span class="line">LUFFY_URL = <span class="string">&#x27;http://39.99.192.127:80&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>wsgi.py 、manage_prod.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改成上线的配置文件</span></span><br><span class="line">os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;luffyapi.settings.prod&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="项目需要的模块进行导出"><a href="#项目需要的模块进行导出" class="headerlink" title="项目需要的模块进行导出"></a>项目需要的模块进行导出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#命令</span><br><span class="line">pip3 freeze &gt; requirement.txt</span><br><span class="line"></span><br><span class="line">ps:如果使用了xadmin需要进行处理</span><br><span class="line">xadmin&#x3D;&#x3D;2.0.1</span><br><span class="line">替换为</span><br><span class="line">https:&#x2F;&#x2F;codeload.github.com&#x2F;sshwsfc&#x2F;xadmin&#x2F;zip&#x2F;django2</span><br></pre></td></tr></table></figure><p>进行上述操作后将项目上传至git即可，接下来我们处理我们的线上环境即可</p><h3 id="项目使用虚拟环境"><a href="#项目使用虚拟环境" class="headerlink" title="项目使用虚拟环境"></a>项目使用虚拟环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">使用虚拟环境之前我们需要将上传到git的项目拉去下来到指定目录</span><br><span class="line">我这边拉取的项目路径是 /home/project</span><br><span class="line">git clone git地址</span><br><span class="line"></span><br><span class="line">项目之前已经安装了虚拟环境，这次我们直接启用即可</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建虚拟环境并使用</span></span><br><span class="line">mkvirtualenv luffy</span><br><span class="line">workon luff</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装项目所需要的模块</span></span><br><span class="line">cd /home/project/luffyapi</span><br><span class="line">pip install -r requirement.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#在虚拟环境中安装uwsgi</span></span><br><span class="line">pip install uwsgi</span><br></pre></td></tr></table></figure><h3 id="uwsgi配置"><a href="#uwsgi配置" class="headerlink" title="uwsgi配置"></a>uwsgi配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在项目根目录的luffyapi这个文件夹下我们新建一个luffyapi.xml的配置文件，到时候我们启动uwsgi需要使用这个配置文件</span><br><span class="line">vim luffyapi.xml </span><br><span class="line">输入</span><br><span class="line">&lt;uwsgi&gt;    </span><br><span class="line">   &lt;socket&gt;127.0.0.1:8808&lt;&#x2F;socket&gt; &lt;!-- 内部端口，自定义,后面配置nginx的配置文件时需要用到 --&gt; </span><br><span class="line">   &lt;chdir&gt;&#x2F;home&#x2F;project&#x2F;luffyapi&#x2F;&lt;&#x2F;chdir&gt; &lt;!-- 项目路径 --&gt;            </span><br><span class="line">   &lt;module&gt;luffyapi.wsgi&lt;&#x2F;module&gt;  &lt;!-- luffyapi是项目根路径下的luffyapi,也就是小的luffyapi--&gt; </span><br><span class="line">   &lt;processes&gt;4&lt;&#x2F;processes&gt; &lt;!-- 进程数 --&gt;     </span><br><span class="line">   &lt;daemonize&gt;uwsgi.log&lt;&#x2F;daemonize&gt; &lt;!-- 日志文件 --&gt;</span><br><span class="line">&lt;&#x2F;uwsgi&gt;</span><br></pre></td></tr></table></figure><h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">我们需要修改nginx的配置文件</span><br><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line">新增一个serve</span><br><span class="line">server &#123;</span><br><span class="line">listen <span class="number">8000</span>;</span><br><span class="line">server_name  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; <span class="comment"># 改为自己的域名，没域名修改为127.0.0.1:80</span></span><br><span class="line">charset utf-<span class="number">8</span>;</span><br><span class="line">location / &#123;</span><br><span class="line">include uwsgi_params;</span><br><span class="line">uwsgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8808</span>;  <span class="comment"># 端口要和uwsgi里配置的一样</span></span><br><span class="line">uwsgi_param UWSGI_SCRIPT luffyapi.wsgi;  <span class="comment">#wsgi.py所在的目录名+.wsgi</span></span><br><span class="line">uwsgi_param UWSGI_CHDIR /home/project/luffyapi/; <span class="comment"># 项目路径</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#静态文件存储的路径python</span></span><br><span class="line">location /static &#123;</span><br><span class="line">            alias /home/project/luffyapi/luffyapi/static; <span class="comment">#你static文件夹的路径</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数据库创建"><a href="#数据库创建" class="headerlink" title="数据库创建"></a>数据库创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">我们进入数据库</span><br><span class="line">mysql -uroot -pxxx</span><br><span class="line"></span><br><span class="line">创建库</span><br><span class="line">create database luffy default charset&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">创建账号，这里的账号要与项目配置文件中的账号密码保持一致</span><br><span class="line">grant all privileges on luffy.* to &#39;luffy&#39;@&#39;%&#39; identified by &#39;Luffy123?&#39;;</span><br><span class="line">grant all privileges on luffy.* to &#39;luffy&#39;@&#39;localhost&#39; identified by &#39;Luffy123?&#39;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="项目数据库表迁移"><a href="#项目数据库表迁移" class="headerlink" title="项目数据库表迁移"></a>项目数据库表迁移</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我们来到项目的根路径下，即&#x2F;home&#x2F;project&#x2F;luffapi</span><br><span class="line"></span><br><span class="line">执行数据库迁移命令</span><br><span class="line">python manage_prod.py makemigrations</span><br><span class="line">python manage_prod.py migrate</span><br></pre></td></tr></table></figure><h3 id="xadmin-rest-framework等静态文件收集"><a href="#xadmin-rest-framework等静态文件收集" class="headerlink" title="xadmin,rest_framework等静态文件收集"></a>xadmin,rest_framework等静态文件收集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">这时我们若是直接上线，我们的后台管理等页面的样式是没有的，我们需要将他们收集到文件夹下</span><br><span class="line">这个文件夹我们设置在内部的luffapi下，取名为static</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建文件夹</span></span><br><span class="line">cd /home/project/luffapi/luffapi</span><br><span class="line">mkdir static</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim settings/prod.py</span><br><span class="line">添加下述几句</span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line">STATIC_ROOT = <span class="string">&#x27;/home/project/luffyapi/luffyapi/static&#x27;</span>  </span><br><span class="line">STATICFILES_DIRS = (os.path.join(BASE_DIR, <span class="string">&quot;static&quot;</span>),)</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用命令迁移静态文件</span></span><br><span class="line">python /home/project/luffyapi/manage_prod.py collectstatic</span><br><span class="line"></span><br><span class="line"><span class="comment">#nginx</span></span><br></pre></td></tr></table></figure><h3 id="启动uwsgi-重启nginx"><a href="#启动uwsgi-重启nginx" class="headerlink" title="启动uwsgi,重启nginx"></a>启动uwsgi,重启nginx</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uwsgi -x /home/project/luffyapi/luffyapi.xml <span class="comment">#你uwsgi配置文件的路径</span></span><br><span class="line"></span><br><span class="line">nginx -s reload <span class="comment">#重启nginx服务的命令</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;后端项目上线&quot;&gt;&lt;a href=&quot;#后端项目上线&quot; class=&quot;headerlink&quot; title=&quot;后端项目上线&quot;&gt;&lt;/a&gt;后端项目上线&lt;/h2&gt;&lt;p&gt;python的后端上线由于操作还是比较繁琐的，因此我们把他单独拉出来讲&lt;/p&gt;
&lt;h3 id=&quot;更换配置文件</summary>
      
    
    
    
    <category term="项目上线" scheme="https://a744740454.github.io/categories/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/"/>
    
    
    <category term="linux" scheme="https://a744740454.github.io/tags/linux/"/>
    
    <category term="nginx" scheme="https://a744740454.github.io/tags/nginx/"/>
    
    <category term="python" scheme="https://a744740454.github.io/tags/python/"/>
    
    <category term="uwsgi" scheme="https://a744740454.github.io/tags/uwsgi/"/>
    
  </entry>
  
  <entry>
    <title>python项目上线</title>
    <link href="https://a744740454.github.io/2021/01/18/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/"/>
    <id>https://a744740454.github.io/2021/01/18/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/</id>
    <published>2021-01-18T11:57:08.651Z</published>
    <updated>2021-01-18T12:39:54.099Z</updated>
    
    <content type="html"><![CDATA[<h2 id="项目上线"><a href="#项目上线" class="headerlink" title="项目上线"></a>项目上线</h2><p>我们在上线项目之前我们需要先进行服务器的购买,可以选择阿里云的服务器,有余裕的小伙伴还可以申请一个域名，再此不一一赘述，只讲上线部分。</p><h3 id="连接服务器"><a href="#连接服务器" class="headerlink" title="连接服务器"></a>连接服务器</h3><p>我们使用xshell去连接我们的服务器，选择阿里云服务器的直接去阿里的控制台查看自己的服务器ip即可</p><h3 id="更新软件包以及常用工具包"><a href="#更新软件包以及常用工具包" class="headerlink" title="更新软件包以及常用工具包"></a>更新软件包以及常用工具包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br><span class="line">yum -y groupinstall &quot;Development tools&quot;</span><br><span class="line">yum install openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel psmisc libffi-devel</span><br></pre></td></tr></table></figure><h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1）前往用户根目录</span><br><span class="line">cd ~</span><br><span class="line"></span><br><span class="line">2）下载mysql57</span><br><span class="line">wget http:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line"></span><br><span class="line">3）安装mysql57</span><br><span class="line">yum -y install mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line">yum -y install mysql-community-server</span><br><span class="line"></span><br><span class="line">4）启动mysql57并查看启动状态</span><br><span class="line">systemctl start mysqld.service</span><br><span class="line">systemctl status mysqld.service</span><br><span class="line"></span><br><span class="line">5）查看默认密码并登录</span><br><span class="line">grep &quot;password&quot; &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">6）修改密码</span><br><span class="line">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;new password&#39;;</span><br></pre></td></tr></table></figure><h3 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1）前往用户根目录</span><br><span class="line">cd ~</span><br><span class="line"></span><br><span class="line">2）下载redis-5.0.5</span><br><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.5.tar.gz</span><br><span class="line"></span><br><span class="line">3）解压安装包</span><br><span class="line">tar -xf redis-5.0.5.tar.gz</span><br><span class="line"></span><br><span class="line">4）进入目标文件</span><br><span class="line">cd redis-5.0.5</span><br><span class="line"></span><br><span class="line">5）编译环境</span><br><span class="line">make&amp;&amp;make install</span><br><span class="line"></span><br><span class="line">6）复制环境到指定路径完成安装</span><br><span class="line">cp -r ~&#x2F;redis-5.0.5 &#x2F;usr&#x2F;local&#x2F;redis</span><br><span class="line"></span><br><span class="line">7）配置redis可以后台启动：修改下方内容</span><br><span class="line">vim &#x2F;usr&#x2F;local&#x2F;redis&#x2F;redis.conf</span><br><span class="line"></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line">8）建立软连接</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;redis&#x2F;src&#x2F;redis-server &#x2F;usr&#x2F;bin&#x2F;redis-server</span><br><span class="line">&gt;: ln -s &#x2F;usr&#x2F;local&#x2F;redis&#x2F;src&#x2F;redis-cli &#x2F;usr&#x2F;bin&#x2F;redis-cli</span><br><span class="line"></span><br><span class="line">9）后台运行redis</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;redis</span><br><span class="line">redis-server .&#x2F;redis.conf &amp;</span><br><span class="line"></span><br><span class="line">10）测试redis环境</span><br><span class="line">redis-cli</span><br><span class="line"></span><br><span class="line">11）关闭redis服务</span><br><span class="line">pkill -f redis -9</span><br></pre></td></tr></table></figure><h3 id="安装python3-6"><a href="#安装python3-6" class="headerlink" title="安装python3.6"></a>安装python3.6</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1）前往用户根目录</span><br><span class="line">cd ~</span><br><span class="line"></span><br><span class="line">2）下载 或 上传 Python3.6.7</span><br><span class="line"># 服务器终端</span><br><span class="line">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.6.7&#x2F;Python-3.6.7.tar.xz</span><br><span class="line"></span><br><span class="line">3）解压安装包</span><br><span class="line">tar -xf Python-3.6.7.tar.xz</span><br><span class="line"></span><br><span class="line">4）进入目标文件</span><br><span class="line">cd Python-3.6.7</span><br><span class="line"></span><br><span class="line">5）配置安装路径：&#x2F;usr&#x2F;local&#x2F;python3</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;python3</span><br><span class="line"></span><br><span class="line">6）编译并安装</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">7）建立软连接：终端命令 python3，pip3</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;python3.6 &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;pip3.6 &#x2F;usr&#x2F;bin&#x2F;pip3</span><br></pre></td></tr></table></figure><h3 id="配置阿里源-阿里云服务器不用配置"><a href="#配置阿里源-阿里云服务器不用配置" class="headerlink" title="配置阿里源(阿里云服务器不用配置)"></a>配置阿里源(阿里云服务器不用配置)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1）创建pip配置路径</span><br><span class="line">mkdir ~&#x2F;.pip</span><br><span class="line"></span><br><span class="line">2）进入目录编辑配置文件：填入下方内容</span><br><span class="line">cd ~&#x2F;.pip &amp;&amp; vim pip.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">index-url &#x3D; http:&#x2F;&#x2F;pypi.douban.com&#x2F;simple</span><br><span class="line">[install]</span><br><span class="line">use-mirrors &#x3D;true</span><br><span class="line">mirrors &#x3D;http:&#x2F;&#x2F;pypi.douban.com&#x2F;simple&#x2F;</span><br><span class="line">trusted-host &#x3D;pypi.douban.com</span><br></pre></td></tr></table></figure><h3 id="安装uwsgi-虚拟环境还需要安装一次"><a href="#安装uwsgi-虚拟环境还需要安装一次" class="headerlink" title="安装uwsgi(虚拟环境还需要安装一次)"></a>安装uwsgi(虚拟环境还需要安装一次)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）在真实环境下安装</span><br><span class="line">pip3 install uwsgi</span><br><span class="line"></span><br><span class="line">2）建立软连接</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;uwsgi &#x2F;usr&#x2F;bin&#x2F;uwsgi</span><br></pre></td></tr></table></figure><h3 id="安装虚拟环境"><a href="#安装虚拟环境" class="headerlink" title="安装虚拟环境"></a>安装虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1）安装依赖</span><br><span class="line">pip3 install virtualenv</span><br><span class="line">pip3 install virtualenvwrapper</span><br><span class="line"></span><br><span class="line">2）建立虚拟环境软连接</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;virtualenv &#x2F;usr&#x2F;bin&#x2F;virtualenv</span><br><span class="line"></span><br><span class="line">3）配置虚拟环境：填入下方内容</span><br><span class="line">vim ~&#x2F;.bash_profile</span><br><span class="line"></span><br><span class="line">VIRTUALENVWRAPPER_PYTHON&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">source &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line">4）更新配置文件内容</span><br><span class="line">source ~&#x2F;.bash_profile</span><br><span class="line"></span><br><span class="line">5）虚拟环境默认根目录：~&#x2F;.virtualenvs</span><br></pre></td></tr></table></figure><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1）前往用户根目录</span><br><span class="line">cd ~</span><br><span class="line"></span><br><span class="line">2）下载nginx1.13.7</span><br><span class="line">wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.13.7.tar.gz</span><br><span class="line"></span><br><span class="line">3）解压安装包</span><br><span class="line">tar -xf nginx-1.13.7.tar.gz</span><br><span class="line"></span><br><span class="line">4）进入目标文件</span><br><span class="line">cd nginx-1.13.7</span><br><span class="line"></span><br><span class="line">5）配置安装路径：&#x2F;usr&#x2F;local&#x2F;nginx</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx</span><br><span class="line"></span><br><span class="line">6）编译并安装</span><br><span class="line">make &amp;&amp; sudo make install</span><br><span class="line"></span><br><span class="line">7）建立软连接：终端命令 nginx</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx &#x2F;usr&#x2F;bin&#x2F;nginx</span><br><span class="line"></span><br><span class="line">9）测试Nginx环境，服务器运行nginx，本地访问服务器ip</span><br><span class="line">nginx启动命令:nginx即可</span><br></pre></td></tr></table></figure><h3 id="Nginx常用命令"><a href="#Nginx常用命令" class="headerlink" title="Nginx常用命令"></a>Nginx常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1）启动</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line">2）关闭nginx</span><br><span class="line">nginx -s stop</span><br><span class="line"></span><br><span class="line">3）重启nginx</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">4）查看端口，强行关闭</span><br><span class="line">ps -aux|grep nginx</span><br><span class="line">kill &lt;pid:进程编号&gt;</span><br></pre></td></tr></table></figure><h3 id="前端项目上线"><a href="#前端项目上线" class="headerlink" title="前端项目上线"></a>前端项目上线</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1.首先我们进入我们的前端vue项目，将settings.js中的base_url修改成服务器的地址</span><br><span class="line">export default &#123;</span><br><span class="line">    base_url: &#39;xx.107.250.120:8000&#39;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.然后执行命令</span><br><span class="line">npm run build</span><br><span class="line"></span><br><span class="line">3.然后你会发现我们在根目录下生成了一个dist文件夹，我们将这个文件夹压缩上传到服务器，没有安装lrzsz的需要安装否则无法上传</span><br><span class="line">yum install lrzsz</span><br><span class="line"></span><br><span class="line">4.我们解压这个文件夹</span><br><span class="line">unzip dist.zip</span><br><span class="line"></span><br><span class="line">5.去nginx进行配置</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf</span><br><span class="line">mv nginx.conf nginx.conf.bak</span><br><span class="line">vim nginx.conf</span><br><span class="line"></span><br><span class="line">6.填入下述内容</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name  127.0.0.1; # 改为自己的域名，没域名修改为127.0.0.1:80</span><br><span class="line">        charset utf-8;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root &#x2F;home&#x2F;html; # html访问路径</span><br><span class="line">            index index.html; # html文件名称</span><br><span class="line">            try_files $uri $uri&#x2F; &#x2F;index.html; # 解决单页面应用刷新404问题</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">7.重启nginx</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;项目上线&quot;&gt;&lt;a href=&quot;#项目上线&quot; class=&quot;headerlink&quot; title=&quot;项目上线&quot;&gt;&lt;/a&gt;项目上线&lt;/h2&gt;&lt;p&gt;我们在上线项目之前我们需要先进行服务器的购买,可以选择阿里云的服务器,有余裕的小伙伴还可以申请一个域名，再此不一一赘述，只讲</summary>
      
    
    
    
    <category term="项目上线" scheme="https://a744740454.github.io/categories/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/"/>
    
    
    <category term="linux" scheme="https://a744740454.github.io/tags/linux/"/>
    
    <category term="nginx" scheme="https://a744740454.github.io/tags/nginx/"/>
    
    <category term="python" scheme="https://a744740454.github.io/tags/python/"/>
    
    <category term="uwsgi" scheme="https://a744740454.github.io/tags/uwsgi/"/>
    
  </entry>
  
  <entry>
    <title>集成支付宝作为第三方收款软件</title>
    <link href="https://a744740454.github.io/2021/01/15/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9B%B8%E5%85%B3/%E4%BD%BF%E7%94%A8%E6%94%AF%E4%BB%98%E5%AE%9D%E4%BD%9C%E4%B8%BA%E7%AC%AC%E4%B8%89%E6%96%B9/"/>
    <id>https://a744740454.github.io/2021/01/15/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9B%B8%E5%85%B3/%E4%BD%BF%E7%94%A8%E6%94%AF%E4%BB%98%E5%AE%9D%E4%BD%9C%E4%B8%BA%E7%AC%AC%E4%B8%89%E6%96%B9/</id>
    <published>2021-01-15T09:21:24.517Z</published>
    <updated>2021-01-18T01:16:06.752Z</updated>
    
    <content type="html"><![CDATA[<h2 id="支付宝官方文档"><a href="#支付宝官方文档" class="headerlink" title="支付宝官方文档"></a>支付宝官方文档</h2><p>链接:<a href="https://opendocs.alipay.com/open/270/105898/">https://opendocs.alipay.com/open/270/105898/</a></p><h2 id="步骤简介"><a href="#步骤简介" class="headerlink" title="步骤简介"></a>步骤简介</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.进行实名认证</span><br><span class="line"></span><br><span class="line">2.下载开发助手</span><br><span class="line">链接:https:&#x2F;&#x2F;opendocs.alipay.com&#x2F;open&#x2F;291&#x2F;introduce</span><br><span class="line"></span><br><span class="line">3.利用开发助手生成RSA2应用密钥以及应用公钥</span><br><span class="line"></span><br><span class="line">4.支付宝开放平台--&gt;沙箱环境--&gt;沙箱应用--&gt;RSA2密钥设置--&gt;获得支付宝公钥</span><br><span class="line"></span><br><span class="line">5.下载沙箱版支付宝(测试用)</span><br><span class="line">链接:https:&#x2F;&#x2F;openhome.alipay.com&#x2F;platform&#x2F;appDaily.htm?tab&#x3D;tool</span><br><span class="line"></span><br><span class="line">6.在沙箱环境中的沙箱账号中获得买家账号以及卖家账号</span><br><span class="line">链接:https:&#x2F;&#x2F;openhome.alipay.com&#x2F;platform&#x2F;appDaily.htm?tab&#x3D;account</span><br><span class="line"></span><br><span class="line">7.由于支付宝没有提供python对应的sdk，因此我们使用第三方的支付宝开源框架alipay</span><br><span class="line">git地址:https:&#x2F;&#x2F;github.com&#x2F;fzlee&#x2F;alipay</span><br><span class="line">使用:pip install python-alipay-sdk --upgrade</span><br><span class="line"></span><br><span class="line">8.在自己的应用中进行配置即可</span><br></pre></td></tr></table></figure><h2 id="详细使用教程"><a href="#详细使用教程" class="headerlink" title="详细使用教程"></a>详细使用教程</h2><p>支付宝的调用流程图如下</p><p><img src="https://gitee.com/a744740454/mypic/raw/master/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.png"></p><h3 id="支付宝调用流程"><a href="#支付宝调用流程" class="headerlink" title="支付宝调用流程"></a>支付宝调用流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.前台点击支付按钮</span><br><span class="line">2.往后台发送post请求,后台获得商品等信息</span><br><span class="line">3.使用alipay往支付宝的接口发送请求，携带前端的返回地址以及后端的回调接口地址。</span><br><span class="line">4.获得支付宝的付款页面地址返回给前端</span><br><span class="line">5.前端跳转到支付宝的支付页面接口</span><br><span class="line">6.用户输入账号密码后跳转回原先的商户页面,前台往后台发送一个get请求,返回订单号,可以通过该订单号去查询订单情况</span><br><span class="line">7.支付宝往我们后端接口地址发送一个异步的post请求</span><br><span class="line">8.后端进行数据库修改等操作</span><br></pre></td></tr></table></figure><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">libs                                    <span class="comment"># 第三方模块都放这个包下</span></span><br><span class="line">    ├── iPay  <span class="comment"># aliapy二次封装包</span></span><br><span class="line">    │   ├── __init__.py <span class="comment"># 包文件</span></span><br><span class="line">    │   ├── pem<span class="comment"># 公钥私钥文件夹</span></span><br><span class="line">    │   │   ├── alipay_public_key.pem<span class="comment"># 支付宝公钥文件</span></span><br><span class="line">    │   │   ├── app_private_key.pem<span class="comment"># 应用私钥文件</span></span><br><span class="line">    │   ├── pay.py<span class="comment"># 支付文件</span></span><br><span class="line">    └── └── settings.py </span><br></pre></td></tr></table></figure><h3 id="alipay-public-key-pem"><a href="#alipay-public-key-pem" class="headerlink" title="alipay_public_key.pem"></a>alipay_public_key.pem</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">支付宝公钥</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><h3 id="app-private-key-pem"><a href="#app-private-key-pem" class="headerlink" title="app_private_key.pem"></a>app_private_key.pem</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">应用私钥</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><h3 id="setting-py"><a href="#setting-py" class="headerlink" title="setting.py"></a>setting.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 应用私钥</span></span><br><span class="line">APP_PRIVATE_KEY_STRING = <span class="built_in">open</span>(os.path.join(os.path.dirname(os.path.abspath(__file__)), <span class="string">&#x27;pem&#x27;</span>, <span class="string">&#x27;app_private_key.pem&#x27;</span>)).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支付宝公钥</span></span><br><span class="line">ALIPAY_PUBLIC_KEY_STRING = <span class="built_in">open</span>(os.path.join(os.path.dirname(os.path.abspath(__file__)), <span class="string">&#x27;pem&#x27;</span>, <span class="string">&#x27;alipay_public_key.pem&#x27;</span>)).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用ID</span></span><br><span class="line">APP_ID = <span class="string">&#x27;2016093000631831&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密方式</span></span><br><span class="line">SIGN = <span class="string">&#x27;RSA2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否是支付宝测试环境(沙箱环境)，如果采用真是支付宝环境，配置False</span></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支付网关</span></span><br><span class="line">GATEWAY = <span class="string">&#x27;https://openapi.alipaydev.com/gateway.do&#x27;</span> <span class="keyword">if</span> DEBUG <span class="keyword">else</span> <span class="string">&#x27;https://openapi.alipay.com/gateway.do&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="pay-py"><a href="#pay-py" class="headerlink" title="pay.py"></a>pay.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> alipay <span class="keyword">import</span> AliPay</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支付对象</span></span><br><span class="line">alipay = AliPay(</span><br><span class="line">    appid=settings.APP_ID,</span><br><span class="line">    app_notify_url=<span class="literal">None</span>,</span><br><span class="line">    app_private_key_string=settings.APP_PRIVATE_KEY_STRING,</span><br><span class="line">    alipay_public_key_string=settings.ALIPAY_PUBLIC_KEY_STRING,</span><br><span class="line">    sign_type=settings.SIGN,</span><br><span class="line">    debug=settings.DEBUG</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支付网关</span></span><br><span class="line">gateway = settings.GATEWAY</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;支付宝官方文档&quot;&gt;&lt;a href=&quot;#支付宝官方文档&quot; class=&quot;headerlink&quot; title=&quot;支付宝官方文档&quot;&gt;&lt;/a&gt;支付宝官方文档&lt;/h2&gt;&lt;p&gt;链接:&lt;a href=&quot;https://opendocs.alipay.com/open/270/1</summary>
      
    
    
    
    <category term="第三方" scheme="https://a744740454.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9/"/>
    
    
    <category term="第三方" scheme="https://a744740454.github.io/tags/%E7%AC%AC%E4%B8%89%E6%96%B9/"/>
    
    <category term="支付宝" scheme="https://a744740454.github.io/tags/%E6%94%AF%E4%BB%98%E5%AE%9D/"/>
    
  </entry>
  
</feed>
